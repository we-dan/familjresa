<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>App</title>
    <meta name="description" content="Built with Shape.town" />
    
  <script data-vite-hmr>(function(){if(window.__VITE_HMR_RUNTIME__)return;window.__VITE_HMR_RUNTIME__=1;try{var _=decodeURIComponent(escape(atob("CihmdW5jdGlvbigpIHsKICAvLyBQcmV2ZW50IGRvdWJsZSBpbml0aWFsaXphdGlvbgogIGlmICh3aW5kb3cuX192aWJlQ29uc29sZUNhcHR1cmUpIHJldHVybjsKICB3aW5kb3cuX192aWJlQ29uc29sZUNhcHR1cmUgPSB0cnVlOwoKICBjb25zdCBNQVhfTE9HU19QRVJfRkxVU0ggPSA1MDsKICBjb25zdCBGTFVTSF9JTlRFUlZBTCA9IDUwMDsKICBjb25zdCBNQVhfQVJHX0xFTkdUSCA9IDEwMDA7CiAgY29uc3QgTUFYX1NUQUNLX0xFTkdUSCA9IDIwMDA7CgogIGxldCBsb2dCdWZmZXIgPSBbXTsKICBsZXQgZmx1c2hUaW1lb3V0ID0gbnVsbDsKCiAgLy8gU2FmZWx5IHNlcmlhbGl6ZSBhcmd1bWVudHMgZm9yIHBvc3RNZXNzYWdlCiAgZnVuY3Rpb24gc2FmZVNlcmlhbGl6ZShhcmcpIHsKICAgIHRyeSB7CiAgICAgIGlmIChhcmcgPT09IHVuZGVmaW5lZCkgcmV0dXJuIHsgdHlwZTogJ3VuZGVmaW5lZCcgfTsKICAgICAgaWYgKGFyZyA9PT0gbnVsbCkgcmV0dXJuIG51bGw7CiAgICAgIGlmICh0eXBlb2YgYXJnID09PSAnZnVuY3Rpb24nKSByZXR1cm4geyB0eXBlOiAnZnVuY3Rpb24nLCBuYW1lOiBhcmcubmFtZSB8fCAnYW5vbnltb3VzJyB9OwogICAgICBpZiAoYXJnIGluc3RhbmNlb2YgRXJyb3IpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogJ2Vycm9yJywKICAgICAgICAgIG5hbWU6IGFyZy5uYW1lLAogICAgICAgICAgbWVzc2FnZTogYXJnLm1lc3NhZ2UsCiAgICAgICAgICBzdGFjazogYXJnLnN0YWNrID8gYXJnLnN0YWNrLnNsaWNlKDAsIE1BWF9TVEFDS19MRU5HVEgpIDogdW5kZWZpbmVkCiAgICAgICAgfTsKICAgICAgfQogICAgICBpZiAodHlwZW9mIGFyZyA9PT0gJ29iamVjdCcpIHsKICAgICAgICBjb25zdCBzdHIgPSBKU09OLnN0cmluZ2lmeShhcmcpOwogICAgICAgIGlmIChzdHIubGVuZ3RoID4gTUFYX0FSR19MRU5HVEgpIHsKICAgICAgICAgIHJldHVybiB7IHR5cGU6ICdvYmplY3QnLCBwcmV2aWV3OiBzdHIuc2xpY2UoMCwgTUFYX0FSR19MRU5HVEgpICsgJy4uLicgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2Uoc3RyKTsKICAgICAgfQogICAgICBpZiAodHlwZW9mIGFyZyA9PT0gJ3N0cmluZycgJiYgYXJnLmxlbmd0aCA+IE1BWF9BUkdfTEVOR1RIKSB7CiAgICAgICAgcmV0dXJuIGFyZy5zbGljZSgwLCBNQVhfQVJHX0xFTkdUSCkgKyAnLi4uJzsKICAgICAgfQogICAgICByZXR1cm4gYXJnOwogICAgfSBjYXRjaCAoZSkgewogICAgICByZXR1cm4geyB0eXBlOiAndW5zZXJpYWxpemFibGUnLCB0b1N0cmluZzogU3RyaW5nKGFyZykuc2xpY2UoMCwgMjAwKSB9OwogICAgfQogIH0KCiAgLy8gU2VuZCBidWZmZXJlZCBsb2dzIHRvIHBhcmVudAogIGZ1bmN0aW9uIGZsdXNoTG9ncygpIHsKICAgIGlmIChsb2dCdWZmZXIubGVuZ3RoID09PSAwKSByZXR1cm47CgogICAgY29uc3QgbG9nc1RvU2VuZCA9IGxvZ0J1ZmZlci5zbGljZSgwLCBNQVhfTE9HU19QRVJfRkxVU0gpOwogICAgbG9nQnVmZmVyID0gbG9nQnVmZmVyLnNsaWNlKE1BWF9MT0dTX1BFUl9GTFVTSCk7CgogICAgdHJ5IHsKICAgICAgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSh7CiAgICAgICAgc291cmNlOiAndmliZS1jb25zb2xlLWNhcHR1cmUnLAogICAgICAgIGxvZ3M6IGxvZ3NUb1NlbmQKICAgICAgfSwgJyonKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgLy8gU2lsZW50bHkgZmFpbCBpZiBwb3N0TWVzc2FnZSBmYWlscwogICAgfQoKICAgIC8vIENvbnRpbnVlIGZsdXNoaW5nIGlmIG1vcmUgbG9ncwogICAgaWYgKGxvZ0J1ZmZlci5sZW5ndGggPiAwKSB7CiAgICAgIGZsdXNoVGltZW91dCA9IHNldFRpbWVvdXQoZmx1c2hMb2dzLCBGTFVTSF9JTlRFUlZBTCk7CiAgICB9IGVsc2UgewogICAgICBmbHVzaFRpbWVvdXQgPSBudWxsOwogICAgfQogIH0KCiAgLy8gU2NoZWR1bGUgYSBmbHVzaAogIGZ1bmN0aW9uIHNjaGVkdWxlRmx1c2goKSB7CiAgICBpZiAoZmx1c2hUaW1lb3V0ID09PSBudWxsKSB7CiAgICAgIGZsdXNoVGltZW91dCA9IHNldFRpbWVvdXQoZmx1c2hMb2dzLCBGTFVTSF9JTlRFUlZBTCk7CiAgICB9CiAgfQoKICAvLyBPdmVycmlkZSBjb25zb2xlIG1ldGhvZHMKICBjb25zdCBvcmlnaW5hbENvbnNvbGUgPSB7CiAgICBsb2c6IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSksCiAgICB3YXJuOiBjb25zb2xlLndhcm4uYmluZChjb25zb2xlKSwKICAgIGVycm9yOiBjb25zb2xlLmVycm9yLmJpbmQoY29uc29sZSksCiAgICBpbmZvOiBjb25zb2xlLmluZm8uYmluZChjb25zb2xlKQogIH07CgogIGZ1bmN0aW9uIGNyZWF0ZU92ZXJyaWRlKHR5cGUpIHsKICAgIHJldHVybiBmdW5jdGlvbiguLi5hcmdzKSB7CiAgICAgIC8vIENhbGwgb3JpZ2luYWwKICAgICAgb3JpZ2luYWxDb25zb2xlW3R5cGVdKC4uLmFyZ3MpOwoKICAgICAgLy8gQ2FwdHVyZSBmb3IgcGFyZW50CiAgICAgIGxvZ0J1ZmZlci5wdXNoKHsKICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSwKICAgICAgICBhcmdzOiBhcmdzLm1hcChzYWZlU2VyaWFsaXplKQogICAgICB9KTsKCiAgICAgIHNjaGVkdWxlRmx1c2goKTsKICAgIH07CiAgfQoKICBjb25zb2xlLmxvZyA9IGNyZWF0ZU92ZXJyaWRlKCdsb2cnKTsKICBjb25zb2xlLndhcm4gPSBjcmVhdGVPdmVycmlkZSgnd2FybicpOwogIGNvbnNvbGUuZXJyb3IgPSBjcmVhdGVPdmVycmlkZSgnZXJyb3InKTsKICBjb25zb2xlLmluZm8gPSBjcmVhdGVPdmVycmlkZSgnaW5mbycpOwoKICAvLyBDYXB0dXJlIHVuY2F1Z2h0IGVycm9ycwogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICB0cnkgewogICAgICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHsKICAgICAgICBzb3VyY2U6ICd2aWJlLWNvbnNvbGUtY2FwdHVyZScsCiAgICAgICAgZXJyb3I6IHsKICAgICAgICAgIHR5cGU6ICdlcnJvcicsCiAgICAgICAgICBtZXNzYWdlOiBldmVudC5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJywKICAgICAgICAgIGZpbGVuYW1lOiBldmVudC5maWxlbmFtZSwKICAgICAgICAgIGxpbmVubzogZXZlbnQubGluZW5vLAogICAgICAgICAgY29sbm86IGV2ZW50LmNvbG5vLAogICAgICAgICAgc3RhY2s6IGV2ZW50LmVycm9yPy5zdGFjaz8uc2xpY2UoMCwgTUFYX1NUQUNLX0xFTkdUSCksCiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCkKICAgICAgICB9CiAgICAgIH0sICcqJyk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIC8vIFNpbGVudGx5IGZhaWwKICAgIH0KICB9KTsKCiAgLy8gQ2FwdHVyZSB1bmhhbmRsZWQgcHJvbWlzZSByZWplY3Rpb25zCiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3VuaGFuZGxlZHJlamVjdGlvbicsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICB0cnkgewogICAgICBjb25zdCByZWFzb24gPSBldmVudC5yZWFzb247CiAgICAgIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2UoewogICAgICAgIHNvdXJjZTogJ3ZpYmUtY29uc29sZS1jYXB0dXJlJywKICAgICAgICBlcnJvcjogewogICAgICAgICAgdHlwZTogJ3VuaGFuZGxlZHJlamVjdGlvbicsCiAgICAgICAgICBtZXNzYWdlOiByZWFzb24/Lm1lc3NhZ2UgfHwgU3RyaW5nKHJlYXNvbikgfHwgJ1VuaGFuZGxlZCBwcm9taXNlIHJlamVjdGlvbicsCiAgICAgICAgICBzdGFjazogcmVhc29uPy5zdGFjaz8uc2xpY2UoMCwgTUFYX1NUQUNLX0xFTkdUSCksCiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCkKICAgICAgICB9CiAgICAgIH0sICcqJyk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIC8vIFNpbGVudGx5IGZhaWwKICAgIH0KICB9KTsKCiAgLy8gRmx1c2ggb24gcGFnZSB1bmxvYWQKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgZnVuY3Rpb24oKSB7CiAgICBpZiAobG9nQnVmZmVyLmxlbmd0aCA+IDApIHsKICAgICAgZmx1c2hMb2dzKCk7CiAgICB9CiAgfSk7Cn0pKCk7CgoKKGZ1bmN0aW9uKCkgewogIC8vIFByZXZlbnQgZG91YmxlIGluaXRpYWxpemF0aW9uCiAgaWYgKHdpbmRvdy5fX3ZpYmVEb21UYWdnZXIpIHJldHVybjsKICB3aW5kb3cuX192aWJlRG9tVGFnZ2VyID0gdHJ1ZTsKCiAgbGV0IGlzQWN0aXZlID0gZmFsc2U7CiAgbGV0IGhvdmVyT3ZlcmxheSA9IG51bGw7CiAgbGV0IGN1cnJlbnRFbGVtZW50ID0gbnVsbDsKICBsZXQgc2VsZWN0aW9uT3ZlcmxheXMgPSBbXTsgLy8gUGVyc2lzdGVudCBzZWxlY3Rpb24gaGlnaGxpZ2h0cwogIGxldCBjdXJyZW50U2VsZWN0aW9uUGF0aHMgPSBbXTsgLy8gVHJhY2sgd2hpY2ggZWxlbWVudHMgYXJlIGN1cnJlbnRseSBzZWxlY3RlZCAocGF0aHMgZnJvbSBwYXJlbnQpCgogIGNvbnN0IE1BWF9JTk5FUl9IVE1MID0gNTAwOwogIGNvbnN0IE1BWF9URVhUX0NPTlRFTlQgPSAyMDA7CgogIC8vIENyZWF0ZSBob3ZlciBoaWdobGlnaHQgb3ZlcmxheQogIGZ1bmN0aW9uIGNyZWF0ZUhvdmVyT3ZlcmxheSgpIHsKICAgIGlmIChob3Zlck92ZXJsYXkpIHJldHVybiBob3Zlck92ZXJsYXk7CgogICAgaG92ZXJPdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBob3Zlck92ZXJsYXkuaWQgPSAndmliZS10YWdnZXItaG92ZXInOwogICAgaG92ZXJPdmVybGF5LnN0eWxlLmNzc1RleHQgPSBgCiAgICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoNTksIDEzMCwgMjQ2LCAwLjE1KTsKICAgICAgYm9yZGVyOiAycHggc29saWQgcmdiYSg1OSwgMTMwLCAyNDYsIDAuOCk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgei1pbmRleDogOTk5OTk4OwogICAgICB0cmFuc2l0aW9uOiBhbGwgMC4xcyBlYXNlOwogICAgICBkaXNwbGF5OiBub25lOwogICAgYDsKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaG92ZXJPdmVybGF5KTsKICAgIHJldHVybiBob3Zlck92ZXJsYXk7CiAgfQoKICAvLyBDcmVhdGUgYSBzZWxlY3Rpb24gaGlnaGxpZ2h0IG92ZXJsYXkgZm9yIGEgc3BlY2lmaWMgZWxlbWVudAogIGZ1bmN0aW9uIGNyZWF0ZVNlbGVjdGlvbk92ZXJsYXkoZWxlbWVudCwgaW5kZXgpIHsKICAgIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIG92ZXJsYXkuY2xhc3NOYW1lID0gJ3ZpYmUtc2VsZWN0aW9uLW92ZXJsYXknOwogICAgb3ZlcmxheS5kYXRhc2V0LnNlbGVjdGlvbkluZGV4ID0gaW5kZXg7CiAgICBvdmVybGF5LnN0eWxlLmNzc1RleHQgPSBgCiAgICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMzQsIDE5NywgOTQsIDAuMTIpOwogICAgICBib3JkZXI6IDJweCBzb2xpZCByZ2JhKDM0LCAxOTcsIDk0LCAwLjcpOwogICAgICBib3JkZXItcmFkaXVzOiA0cHg7CiAgICAgIHotaW5kZXg6IDk5OTk5NzsKICAgIGA7CgogICAgLy8gQWRkIGluZGV4IGJhZGdlCiAgICBjb25zdCBiYWRnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgYmFkZ2Uuc3R5bGUuY3NzVGV4dCA9IGAKICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICB0b3A6IC0xMHB4OwogICAgICBsZWZ0OiAtMTBweDsKICAgICAgd2lkdGg6IDIwcHg7CiAgICAgIGhlaWdodDogMjBweDsKICAgICAgYmFja2dyb3VuZDogIzIyYzU1ZTsKICAgICAgY29sb3I6IHdoaXRlOwogICAgICBmb250LXNpemU6IDExcHg7CiAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgIGZvbnQtZmFtaWx5OiAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsIHNhbnMtc2VyaWY7CiAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgIGJveC1zaGFkb3c6IDAgMnB4IDRweCByZ2JhKDAsMCwwLDAuMik7CiAgICBgOwogICAgYmFkZ2UudGV4dENvbnRlbnQgPSBTdHJpbmcoaW5kZXggKyAxKTsKICAgIG92ZXJsYXkuYXBwZW5kQ2hpbGQoYmFkZ2UpOwoKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3ZlcmxheSk7CiAgICByZXR1cm4gb3ZlcmxheTsKICB9CgogIC8vIFVwZGF0ZSBzZWxlY3Rpb24gb3ZlcmxheSBwb3NpdGlvbgogIGZ1bmN0aW9uIHVwZGF0ZVNlbGVjdGlvbk92ZXJsYXkob3ZlcmxheSwgcmVjdCkgewogICAgb3ZlcmxheS5zdHlsZS5sZWZ0ID0gcmVjdC54ICsgJ3B4JzsKICAgIG92ZXJsYXkuc3R5bGUudG9wID0gcmVjdC55ICsgJ3B4JzsKICAgIG92ZXJsYXkuc3R5bGUud2lkdGggPSByZWN0LndpZHRoICsgJ3B4JzsKICAgIG92ZXJsYXkuc3R5bGUuaGVpZ2h0ID0gcmVjdC5oZWlnaHQgKyAncHgnOwogIH0KCiAgLy8gQ2xlYXIgYWxsIHNlbGVjdGlvbiBvdmVybGF5cwogIGZ1bmN0aW9uIGNsZWFyU2VsZWN0aW9uT3ZlcmxheXMoKSB7CiAgICBzZWxlY3Rpb25PdmVybGF5cy5mb3JFYWNoKG8gPT4gby5yZW1vdmUoKSk7CiAgICBzZWxlY3Rpb25PdmVybGF5cyA9IFtdOwogIH0KCiAgLy8gRmluZCBlbGVtZW50IGJ5IHBhdGggKGJlc3QgZWZmb3J0IG1hdGNoaW5nKQogIGZ1bmN0aW9uIGZpbmRFbGVtZW50QnlQYXRoKHBhdGgpIHsKICAgIC8vIFRyeSBkaXJlY3QgcXVlcnlTZWxlY3RvciBmaXJzdAogICAgdHJ5IHsKICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBhdGgpOwogICAgICBpZiAoZWwpIHJldHVybiBlbDsKICAgIH0gY2F0Y2ggeyAvKiBzZWxlY3RvciBtYXkgYmUgaW52YWxpZCAtIGNvbnRpbnVlICovIH0KCiAgICAvLyBGYWxsYmFjazogc2VhcmNoIGJ5IHBhcnRzCiAgICBjb25zdCBwYXJ0cyA9IHBhdGguc3BsaXQoJyA+ICcpOwogICAgbGV0IGNhbmRpZGF0ZXMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwocGFydHNbcGFydHMubGVuZ3RoIC0gMV0uc3BsaXQoJy4nKVswXS5zcGxpdCgnIycpWzBdKSk7CgogICAgZm9yIChjb25zdCBjYW5kaWRhdGUgb2YgY2FuZGlkYXRlcykgewogICAgICBpZiAoZ2V0RWxlbWVudFBhdGgoY2FuZGlkYXRlKSA9PT0gcGF0aCkgewogICAgICAgIHJldHVybiBjYW5kaWRhdGU7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gbnVsbDsKICB9CgogIC8vIFVwZGF0ZSBzZWxlY3Rpb24gaGlnaGxpZ2h0cyBmcm9tIHBhcmVudAogIGZ1bmN0aW9uIHVwZGF0ZVNlbGVjdGlvbnMocGF0aHMpIHsKICAgIC8vIFN0b3JlIHRoZSBwYXRocyBmb3IgZGVzZWxlY3Rpb24gZGV0ZWN0aW9uCiAgICBjdXJyZW50U2VsZWN0aW9uUGF0aHMgPSBwYXRocyB8fCBbXTsKCiAgICBjbGVhclNlbGVjdGlvbk92ZXJsYXlzKCk7CgogICAgY3VycmVudFNlbGVjdGlvblBhdGhzLmZvckVhY2goKHBhdGgsIGluZGV4KSA9PiB7CiAgICAgIGNvbnN0IGVsZW1lbnQgPSBmaW5kRWxlbWVudEJ5UGF0aChwYXRoKTsKICAgICAgaWYgKGVsZW1lbnQpIHsKICAgICAgICBjb25zdCByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICBjb25zdCBvdmVybGF5ID0gY3JlYXRlU2VsZWN0aW9uT3ZlcmxheShlbGVtZW50LCBpbmRleCk7CiAgICAgICAgdXBkYXRlU2VsZWN0aW9uT3ZlcmxheShvdmVybGF5LCByZWN0KTsKICAgICAgICBzZWxlY3Rpb25PdmVybGF5cy5wdXNoKG92ZXJsYXkpOwogICAgICB9CiAgICB9KTsKICB9CgogIC8vIENoZWNrIGlmIGFuIGVsZW1lbnQncyBwYXRoIGlzIGluIGN1cnJlbnQgc2VsZWN0aW9ucwogIGZ1bmN0aW9uIGlzRWxlbWVudFNlbGVjdGVkKGVsKSB7CiAgICBjb25zdCBwYXRoID0gZ2V0RWxlbWVudFBhdGgoZWwpOwogICAgcmV0dXJuIGN1cnJlbnRTZWxlY3Rpb25QYXRocy5pbmNsdWRlcyhwYXRoKTsKICB9CgogIC8vIFVwZGF0ZSBzZWxlY3Rpb24gcG9zaXRpb25zIG9uIHNjcm9sbC9yZXNpemUKICBmdW5jdGlvbiB1cGRhdGVTZWxlY3Rpb25Qb3NpdGlvbnMoKSB7CiAgICAvLyBSZS1maW5kIGVsZW1lbnRzIGFuZCB1cGRhdGUgcG9zaXRpb25zIChwYXRocyBtYXkgaGF2ZSBzaGlmdGVkKQogICAgY29uc3QgcGF0aHMgPSBzZWxlY3Rpb25PdmVybGF5cy5tYXAoKG8sIGkpID0+IG8uZGF0YXNldC5wYXRoKS5maWx0ZXIoQm9vbGVhbik7CiAgICBpZiAocGF0aHMubGVuZ3RoID4gMCkgewogICAgICAvLyBTaW1wbGUgcG9zaXRpb24gcmVmcmVzaAogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudmliZS1zZWxlY3Rpb24tb3ZlcmxheScpLmZvckVhY2gob3ZlcmxheSA9PiB7CiAgICAgICAgLy8gUG9zaXRpb25zIGdldCB1cGRhdGVkIG9uIG5leHQgdXBkYXRlU2VsZWN0aW9ucyBjYWxsCiAgICAgIH0pOwogICAgfQogIH0KCiAgLy8gR2V0IGVsZW1lbnQgcGF0aCAoQ1NTIHNlbGVjdG9yLWxpa2UpCiAgZnVuY3Rpb24gZ2V0RWxlbWVudFBhdGgoZWwpIHsKICAgIGNvbnN0IHBhcnRzID0gW107CiAgICBsZXQgY3VycmVudCA9IGVsOwogICAgbGV0IGRlcHRoID0gMDsKCiAgICB3aGlsZSAoY3VycmVudCAmJiBjdXJyZW50ICE9PSBkb2N1bWVudC5ib2R5ICYmIGRlcHRoIDwgNSkgewogICAgICBsZXQgc2VsZWN0b3IgPSBjdXJyZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgaWYgKGN1cnJlbnQuaWQpIHsKICAgICAgICBzZWxlY3RvciArPSAnIycgKyBjdXJyZW50LmlkOwogICAgICB9IGVsc2UgaWYgKGN1cnJlbnQuY2xhc3NOYW1lICYmIHR5cGVvZiBjdXJyZW50LmNsYXNzTmFtZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICBjb25zdCBjbGFzc2VzID0gY3VycmVudC5jbGFzc05hbWUudHJpbSgpLnNwbGl0KC9ccysvKS5zbGljZSgwLCAyKTsKICAgICAgICBpZiAoY2xhc3Nlcy5sZW5ndGggPiAwICYmIGNsYXNzZXNbMF0pIHsKICAgICAgICAgIHNlbGVjdG9yICs9ICcuJyArIGNsYXNzZXMuam9pbignLicpOwogICAgICAgIH0KICAgICAgfQogICAgICBwYXJ0cy51bnNoaWZ0KHNlbGVjdG9yKTsKICAgICAgY3VycmVudCA9IGN1cnJlbnQucGFyZW50RWxlbWVudDsKICAgICAgZGVwdGgrKzsKICAgIH0KCiAgICByZXR1cm4gcGFydHMuam9pbignID4gJyk7CiAgfQoKICAvLyBHZXQgcGFyZW50IHN0cnVjdHVyZQogIGZ1bmN0aW9uIGdldFBhcmVudFN0cnVjdHVyZShlbCkgewogICAgY29uc3QgcGFydHMgPSBbXTsKICAgIGxldCBjdXJyZW50ID0gZWwucGFyZW50RWxlbWVudDsKICAgIGxldCBkZXB0aCA9IDA7CgogICAgd2hpbGUgKGN1cnJlbnQgJiYgY3VycmVudCAhPT0gZG9jdW1lbnQuYm9keSAmJiBkZXB0aCA8IDMpIHsKICAgICAgbGV0IGluZm8gPSBjdXJyZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgaWYgKGN1cnJlbnQuaWQpIGluZm8gKz0gJyMnICsgY3VycmVudC5pZDsKICAgICAgaWYgKGN1cnJlbnQuY2xhc3NOYW1lICYmIHR5cGVvZiBjdXJyZW50LmNsYXNzTmFtZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICBjb25zdCBjbGFzc2VzID0gY3VycmVudC5jbGFzc05hbWUudHJpbSgpLnNwbGl0KC9ccysvKS5zbGljZSgwLCAyKTsKICAgICAgICBpZiAoY2xhc3Nlcy5sZW5ndGggPiAwICYmIGNsYXNzZXNbMF0pIHsKICAgICAgICAgIGluZm8gKz0gJy4nICsgY2xhc3Nlcy5qb2luKCcuJyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHBhcnRzLnB1c2goaW5mbyk7CiAgICAgIGN1cnJlbnQgPSBjdXJyZW50LnBhcmVudEVsZW1lbnQ7CiAgICAgIGRlcHRoKys7CiAgICB9CgogICAgcmV0dXJuIHBhcnRzLmpvaW4oJyA8ICcpOwogIH0KCiAgLy8gR2V0IGVsZW1lbnQgaW5mbwogIGZ1bmN0aW9uIGdldEVsZW1lbnRJbmZvKGVsKSB7CiAgICBjb25zdCByZWN0ID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICBjb25zdCBjb21wdXRlZCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsKTsKCiAgICBjb25zdCBhdHRycyA9IHt9OwogICAgZm9yIChjb25zdCBhdHRyIG9mIGVsLmF0dHJpYnV0ZXMpIHsKICAgICAgaWYgKGF0dHIubmFtZSAhPT0gJ3N0eWxlJyAmJiAhYXR0ci5uYW1lLnN0YXJ0c1dpdGgoJ2RhdGEtdmliZScpKSB7CiAgICAgICAgYXR0cnNbYXR0ci5uYW1lXSA9IGF0dHIudmFsdWUuc2xpY2UoMCwgMTAwKTsKICAgICAgfQogICAgfQoKICAgIGxldCBpbm5lckhUTUwgPSBlbC5pbm5lckhUTUw7CiAgICBpZiAoaW5uZXJIVE1MICYmIGlubmVySFRNTC5sZW5ndGggPiBNQVhfSU5ORVJfSFRNTCkgewogICAgICBpbm5lckhUTUwgPSBpbm5lckhUTUwuc2xpY2UoMCwgTUFYX0lOTkVSX0hUTUwpICsgJy4uLic7CiAgICB9CgogICAgbGV0IHRleHRDb250ZW50ID0gZWwudGV4dENvbnRlbnQ/LnRyaW0oKTsKICAgIGlmICh0ZXh0Q29udGVudCAmJiB0ZXh0Q29udGVudC5sZW5ndGggPiBNQVhfVEVYVF9DT05URU5UKSB7CiAgICAgIHRleHRDb250ZW50ID0gdGV4dENvbnRlbnQuc2xpY2UoMCwgTUFYX1RFWFRfQ09OVEVOVCkgKyAnLi4uJzsKICAgIH0KCiAgICByZXR1cm4gewogICAgICB0YWdOYW1lOiBlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCksCiAgICAgIGlkOiBlbC5pZCB8fCB1bmRlZmluZWQsCiAgICAgIGNsYXNzTmFtZTogZWwuY2xhc3NOYW1lICYmIHR5cGVvZiBlbC5jbGFzc05hbWUgPT09ICdzdHJpbmcnID8gZWwuY2xhc3NOYW1lIDogdW5kZWZpbmVkLAogICAgICB0ZXh0Q29udGVudDogdGV4dENvbnRlbnQgfHwgdW5kZWZpbmVkLAogICAgICBhdHRyaWJ1dGVzOiBhdHRycywKICAgICAgYm91bmRpbmdSZWN0OiB7CiAgICAgICAgeDogTWF0aC5yb3VuZChyZWN0LngpLAogICAgICAgIHk6IE1hdGgucm91bmQocmVjdC55KSwKICAgICAgICB3aWR0aDogTWF0aC5yb3VuZChyZWN0LndpZHRoKSwKICAgICAgICBoZWlnaHQ6IE1hdGgucm91bmQocmVjdC5oZWlnaHQpCiAgICAgIH0sCiAgICAgIHBhdGg6IGdldEVsZW1lbnRQYXRoKGVsKSwKICAgICAgcGFyZW50U3RydWN0dXJlOiBnZXRQYXJlbnRTdHJ1Y3R1cmUoZWwpLAogICAgICBpbm5lckhUTUw6IGlubmVySFRNTCB8fCB1bmRlZmluZWQsCiAgICAgIGNvbXB1dGVkU3R5bGVzOiB7CiAgICAgICAgZGlzcGxheTogY29tcHV0ZWQuZGlzcGxheSwKICAgICAgICBwb3NpdGlvbjogY29tcHV0ZWQucG9zaXRpb24sCiAgICAgICAgdmlzaWJpbGl0eTogY29tcHV0ZWQudmlzaWJpbGl0eSwKICAgICAgICBvcGFjaXR5OiBjb21wdXRlZC5vcGFjaXR5LAogICAgICAgIGJhY2tncm91bmRDb2xvcjogY29tcHV0ZWQuYmFja2dyb3VuZENvbG9yLAogICAgICAgIGNvbG9yOiBjb21wdXRlZC5jb2xvcgogICAgICB9CiAgICB9OwogIH0KCiAgLy8gU2NyZWVuc2hvdCBjYXB0dXJlIGRpc2FibGVkCiAgYXN5bmMgZnVuY3Rpb24gY2FwdHVyZUVsZW1lbnRTY3JlZW5zaG90KGVsKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CgogIC8vIEhhbmRsZSBtb3VzZSBtb3ZlCiAgZnVuY3Rpb24gaGFuZGxlTW91c2VNb3ZlKGUpIHsKICAgIGlmICghaXNBY3RpdmUpIHJldHVybjsKCiAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldDsKICAgIGlmICghdGFyZ2V0IHx8IHRhcmdldCA9PT0gaG92ZXJPdmVybGF5IHx8IHRhcmdldC5pZCA9PT0gJ3ZpYmUtdGFnZ2VyLWhvdmVyJyB8fAogICAgICAgIHRhcmdldC5jbGFzc0xpc3Q/LmNvbnRhaW5zKCd2aWJlLXNlbGVjdGlvbi1vdmVybGF5JykpIHJldHVybjsKCiAgICBjdXJyZW50RWxlbWVudCA9IHRhcmdldDsKCiAgICBjb25zdCByZWN0ID0gdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgY29uc3Qgb3ZlcmxheSA9IGNyZWF0ZUhvdmVyT3ZlcmxheSgpOwogICAgb3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgIG92ZXJsYXkuc3R5bGUubGVmdCA9IHJlY3QueCArICdweCc7CiAgICBvdmVybGF5LnN0eWxlLnRvcCA9IHJlY3QueSArICdweCc7CiAgICBvdmVybGF5LnN0eWxlLndpZHRoID0gcmVjdC53aWR0aCArICdweCc7CiAgICBvdmVybGF5LnN0eWxlLmhlaWdodCA9IHJlY3QuaGVpZ2h0ICsgJ3B4JzsKICB9CgogIC8vIEhhbmRsZSBjbGljawogIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUNsaWNrKGUpIHsKICAgIGlmICghaXNBY3RpdmUgfHwgIWN1cnJlbnRFbGVtZW50KSByZXR1cm47CgogICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICBjb25zdCBlbGVtZW50UGF0aCA9IGdldEVsZW1lbnRQYXRoKGN1cnJlbnRFbGVtZW50KTsKCiAgICAvLyBDaGVjayBpZiBlbGVtZW50IGlzIGFscmVhZHkgc2VsZWN0ZWQgLSBpZiBzbywgZGVzZWxlY3QgaXQKICAgIGlmIChjdXJyZW50U2VsZWN0aW9uUGF0aHMuaW5jbHVkZXMoZWxlbWVudFBhdGgpKSB7CiAgICAgIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2UoewogICAgICAgIHNvdXJjZTogJ3ZpYmUtZG9tLXRhZ2dlcicsCiAgICAgICAgdHlwZTogJ2VsZW1lbnQtZGVzZWxlY3RlZCcsCiAgICAgICAgcGF0aDogZWxlbWVudFBhdGgKICAgICAgfSwgJyonKTsKICAgICAgLy8gU3RheSBhY3RpdmUgZm9yIG1vcmUgc2VsZWN0aW9ucy9kZXNlbGVjdGlvbnMKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIE90aGVyd2lzZSwgc2VsZWN0IHRoZSBlbGVtZW50CiAgICBjb25zdCBlbGVtZW50SW5mbyA9IGdldEVsZW1lbnRJbmZvKGN1cnJlbnRFbGVtZW50KTsKICAgIGNvbnN0IHNjcmVlbnNob3QgPSBhd2FpdCBjYXB0dXJlRWxlbWVudFNjcmVlbnNob3QoY3VycmVudEVsZW1lbnQpOwoKICAgIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2UoewogICAgICBzb3VyY2U6ICd2aWJlLWRvbS10YWdnZXInLAogICAgICB0eXBlOiAnZWxlbWVudC1zZWxlY3RlZCcsCiAgICAgIGRhdGE6IHsKICAgICAgICBlbGVtZW50OiBlbGVtZW50SW5mbywKICAgICAgICBzY3JlZW5zaG90OiBzY3JlZW5zaG90LAogICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKQogICAgICB9CiAgICB9LCAnKicpOwoKICAgIC8vIFN0YXkgYWN0aXZlIGZvciBtb3JlIHNlbGVjdGlvbnMvZGVzZWxlY3Rpb25zCiAgfQoKICAvLyBIYW5kbGUgZXNjYXBlIGtleQogIGZ1bmN0aW9uIGhhbmRsZUtleURvd24oZSkgewogICAgaWYgKCFpc0FjdGl2ZSkgcmV0dXJuOwoKICAgIGlmIChlLmtleSA9PT0gJ0VzY2FwZScpIHsKICAgICAgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSh7CiAgICAgICAgc291cmNlOiAndmliZS1kb20tdGFnZ2VyJywKICAgICAgICB0eXBlOiAndGFnZ2VyLWNhbmNlbGxlZCcKICAgICAgfSwgJyonKTsKICAgICAgZGVhY3RpdmF0ZSgpOwogICAgfQogIH0KCiAgLy8gQWN0aXZhdGUgdGFnZ2VyIG1vZGUKICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHsKICAgIGlmIChpc0FjdGl2ZSkgcmV0dXJuOwogICAgaXNBY3RpdmUgPSB0cnVlOwoKICAgIGNyZWF0ZUhvdmVyT3ZlcmxheSgpOwogICAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAnY3Jvc3NoYWlyJzsKCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBoYW5kbGVNb3VzZU1vdmUsIHRydWUpOwogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVDbGljaywgdHJ1ZSk7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgaGFuZGxlS2V5RG93biwgdHJ1ZSk7CgogICAgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSh7CiAgICAgIHNvdXJjZTogJ3ZpYmUtZG9tLXRhZ2dlcicsCiAgICAgIHR5cGU6ICd0YWdnZXItcmVhZHknCiAgICB9LCAnKicpOwogIH0KCiAgLy8gRGVhY3RpdmF0ZSB0YWdnZXIgbW9kZQogIGZ1bmN0aW9uIGRlYWN0aXZhdGUoKSB7CiAgICBpZiAoIWlzQWN0aXZlKSByZXR1cm47CiAgICBpc0FjdGl2ZSA9IGZhbHNlOwoKICAgIGlmIChob3Zlck92ZXJsYXkpIHsKICAgICAgaG92ZXJPdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICB9CiAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9ICcnOwogICAgY3VycmVudEVsZW1lbnQgPSBudWxsOwoKICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGhhbmRsZU1vdXNlTW92ZSwgdHJ1ZSk7CiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUNsaWNrLCB0cnVlKTsKICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBoYW5kbGVLZXlEb3duLCB0cnVlKTsKICB9CgogIC8vIExpc3RlbiBmb3IgY29tbWFuZHMgZnJvbSBwYXJlbnQKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICBjb25zdCBkYXRhID0gZXZlbnQuZGF0YTsKICAgIGlmICghZGF0YSB8fCBkYXRhLnNvdXJjZSAhPT0gJ3ZpYmUtZG9tLXRhZ2dlci1jb21tYW5kJykgcmV0dXJuOwoKICAgIGlmIChkYXRhLmFjdGlvbiA9PT0gJ2FjdGl2YXRlJykgewogICAgICBhY3RpdmF0ZSgpOwogICAgfSBlbHNlIGlmIChkYXRhLmFjdGlvbiA9PT0gJ2RlYWN0aXZhdGUnKSB7CiAgICAgIGRlYWN0aXZhdGUoKTsKICAgIH0gZWxzZSBpZiAoZGF0YS5hY3Rpb24gPT09ICd1cGRhdGUtc2VsZWN0aW9ucycpIHsKICAgICAgdXBkYXRlU2VsZWN0aW9ucyhkYXRhLnNlbGVjdGlvbnMgfHwgW10pOwogICAgfQogIH0pOwoKICAvLyBVcGRhdGUgc2VsZWN0aW9uIHBvc2l0aW9ucyBvbiBzY3JvbGwKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdXBkYXRlU2VsZWN0aW9uUG9zaXRpb25zLCB7IHBhc3NpdmU6IHRydWUgfSk7CiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHVwZGF0ZVNlbGVjdGlvblBvc2l0aW9ucywgeyBwYXNzaXZlOiB0cnVlIH0pOwp9KSgpOwoKCihmdW5jdGlvbigpIHsKICAvLyBWZXJzaW9uIGNoZWNrIC0gYWxsb3dzIHJlLWluamVjdGlvbiB3aGVuIHNjcmlwdCBpcyB1cGRhdGVkCiAgY29uc3QgU0NSSVBUX1ZFUlNJT04gPSA4OwogIGlmICh3aW5kb3cuX192aWJlQXV0b21hdGlvblZlcnNpb24gPj0gU0NSSVBUX1ZFUlNJT04pIHJldHVybjsKICB3aW5kb3cuX192aWJlQXV0b21hdGlvblZlcnNpb24gPSBTQ1JJUFRfVkVSU0lPTjsKICB3aW5kb3cuX192aWJlQXV0b21hdGlvbiA9IHRydWU7CiAgd2luZG93Ll9fdmliZUF1dG9tYXRpb25SZWFkeSA9IHRydWU7IC8vIFNpZ25hbCB0aGF0IHdlJ3JlIHJlYWR5IHRvIHJlY2VpdmUgbWVzc2FnZXMKCiAgLy8gU2lsZW50IG9wZXJhdGlvbiAtIG5vIGNvbnNvbGUgb3V0cHV0IHRvIHVzZXIncyBwcmV2aWV3CiAgY29uc3QgbG9nID0gKCkgPT4ge307CiAgY29uc3Qgd2FybiA9ICgpID0+IHt9OwogIGNvbnN0IGVycm9yID0gKCkgPT4ge307IC8vIFNpbGVudCBldmVuIG9uIGVycm9ycyAtIGludGVybmFsIGhhbmRsaW5nIG9ubHkKCiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgLy8gVklTVUFMIEhJR0hMSUdIVCBTVFlMRVMgLSBNYXRjaGVzIERPTSB0YWdnZXIgc3R5bGUKICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICBjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgc3R5bGUudGV4dENvbnRlbnQgPSBgCiAgICAvKiBBSSBBY3Rpb24gSGlnaGxpZ2h0IC0gU2ltcGxlIGJsdWUgYm94IGxpa2UgRE9NIHRhZ2dlciAqLwogICAgLnZpYmUtYWktaGlnaGxpZ2h0IHsKICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgICAgei1pbmRleDogOTk5OTk5OwogICAgICBib3JkZXI6IDJweCBzb2xpZCByZ2JhKDU5LCAxMzAsIDI0NiwgMC44KTsKICAgICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDU5LCAxMzAsIDI0NiwgMC4xNSk7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOiBmbGV4LWVuZDsKICAgICAganVzdGlmeS1jb250ZW50OiBmbGV4LWVuZDsKICAgICAgcGFkZGluZzogNHB4OwogICAgfQoKICAgIC52aWJlLWFpLWhpZ2hsaWdodDo6YWZ0ZXIgewogICAgICBjb250ZW50OiBhdHRyKGRhdGEtYWN0aW9uKTsKICAgICAgZm9udC1zaXplOiA5cHg7CiAgICAgIGZvbnQtd2VpZ2h0OiA1MDA7CiAgICAgIGZvbnQtZmFtaWx5OiAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsIHNhbnMtc2VyaWY7CiAgICAgIGNvbG9yOiByZ2JhKDU5LCAxMzAsIDI0NiwgMC42KTsKICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgICAgbGV0dGVyLXNwYWNpbmc6IDAuNXB4OwogICAgfQoKICAgIC8qIENsaWNrIHJpcHBsZSBlZmZlY3QgKi8KICAgIC52aWJlLWFpLWNsaWNrLXJpcHBsZSB7CiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICAgIHotaW5kZXg6IDk5OTk5ODsKICAgICAgd2lkdGg6IDMwcHg7CiAgICAgIGhlaWdodDogMzBweDsKICAgICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDU5LCAxMzAsIDI0NiwgMC4zKTsKICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMCk7CiAgICAgIGFuaW1hdGlvbjogdmliZS1haS1yaXBwbGUgMC40cyBlYXNlLW91dCBmb3J3YXJkczsKICAgIH0KCiAgICBAa2V5ZnJhbWVzIHZpYmUtYWktcmlwcGxlIHsKICAgICAgMCUgewogICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHNjYWxlKDApOwogICAgICAgIG9wYWNpdHk6IDE7CiAgICAgIH0KICAgICAgMTAwJSB7CiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMik7CiAgICAgICAgb3BhY2l0eTogMDsKICAgICAgfQogICAgfQoKICAgIC8qIFR5cGluZyBpbmRpY2F0b3IgLSBtdXRlZCBzdHlsZSAqLwogICAgLnZpYmUtYWktdHlwaW5nIHsKICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgICAgei1pbmRleDogOTk5OTk5OwogICAgICBwYWRkaW5nOiA0cHggOHB4OwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDU5LCAxMzAsIDI0NiwgMC4xKTsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSg1OSwgMTMwLCAyNDYsIDAuMyk7CiAgICAgIGNvbG9yOiByZ2JhKDU5LCAxMzAsIDI0NiwgMC43KTsKICAgICAgZm9udC1zaXplOiAxMXB4OwogICAgICBmb250LWZhbWlseTogJ1NGIE1vbm8nLCBNb25hY28sIG1vbm9zcGFjZTsKICAgICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgfQogIGA7CiAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7CgogIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAogIC8vIEVMRU1FTlQgRklORElORyAtIERSQU1BVElDQUxMWSBJTVBST1ZFRCBBQ0NVUkFDWQogIC8vIFN1cHBvcnRzOiBTaGFkb3cgRE9NLCBXZWIgQ29tcG9uZW50cywgRHluYW1pYyBDb250ZW50LCBEZWVwIE5lc3RpbmcKICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKCiAgLy8gSW50ZXJhY3RpdmUgZWxlbWVudCBzZWxlY3RvcnMgKHdoYXQgdXNlcnMgYWN0dWFsbHkgd2FudCB0byBjbGljaykKICBjb25zdCBJTlRFUkFDVElWRV9TRUxFQ1RPUlMgPSAnYnV0dG9uLCBhLCBbcm9sZT0iYnV0dG9uIl0sIFtyb2xlPSJsaW5rIl0sIGlucHV0LCBzZWxlY3QsIHRleHRhcmVhLCBsYWJlbCwgW3RhYmluZGV4XTpub3QoW3RhYmluZGV4PSItMSJdKSc7CiAgY29uc3QgQ09OVEFJTkVSX1NFTEVDVE9SUyA9ICdkaXYsIHNwYW4sIHNlY3Rpb24sIGFydGljbGUsIG1haW4sIGhlYWRlciwgZm9vdGVyLCBuYXYsIGFzaWRlLCBmb3JtJzsKICBjb25zdCBIRUFESU5HX1NFTEVDVE9SUyA9ICdoMSwgaDIsIGgzLCBoNCwgaDUsIGg2LCBwJzsKCiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgLy8gU0hBRE9XIERPTSBUUkFWRVJTQUwgLSBDcml0aWNhbCBmb3IgV2ViIENvbXBvbmVudHMgJiBVSSBMaWJyYXJpZXMKICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKCiAgLy8gUmVjdXJzaXZlbHkgZmluZCBhbGwgZWxlbWVudHMgbWF0Y2hpbmcgc2VsZWN0b3IsIGluY2x1ZGluZyBpbnNpZGUgc2hhZG93IERPTXMKICBmdW5jdGlvbiBxdWVyeVNlbGVjdG9yQWxsRGVlcChzZWxlY3Rvciwgcm9vdCA9IGRvY3VtZW50KSB7CiAgICBjb25zdCByZXN1bHRzID0gW107CgogICAgLy8gR2V0IGVsZW1lbnRzIGZyb20gY3VycmVudCByb290CiAgICB0cnkgewogICAgICBjb25zdCBlbGVtZW50cyA9IHJvb3QucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICAgIHJlc3VsdHMucHVzaCguLi5lbGVtZW50cyk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIC8vIEludmFsaWQgc2VsZWN0b3IsIHNraXAKICAgIH0KCiAgICAvLyBSZWN1cnNpdmVseSBzZWFyY2ggc2hhZG93IHJvb3RzCiAgICBjb25zdCBhbGxFbGVtZW50cyA9IHJvb3QucXVlcnlTZWxlY3RvckFsbCgnKicpOwogICAgZm9yIChjb25zdCBlbCBvZiBhbGxFbGVtZW50cykgewogICAgICBpZiAoZWwuc2hhZG93Um9vdCkgewogICAgICAgIGNvbnN0IHNoYWRvd1Jlc3VsdHMgPSBxdWVyeVNlbGVjdG9yQWxsRGVlcChzZWxlY3RvciwgZWwuc2hhZG93Um9vdCk7CiAgICAgICAgcmVzdWx0cy5wdXNoKC4uLnNoYWRvd1Jlc3VsdHMpOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQoKICAvLyBGaW5kIHNpbmdsZSBlbGVtZW50IGluY2x1ZGluZyBzaGFkb3cgRE9NCiAgZnVuY3Rpb24gcXVlcnlTZWxlY3RvckRlZXAoc2VsZWN0b3IsIHJvb3QgPSBkb2N1bWVudCkgewogICAgLy8gVHJ5IGN1cnJlbnQgcm9vdCBmaXJzdAogICAgdHJ5IHsKICAgICAgY29uc3QgZWxlbWVudCA9IHJvb3QucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7CiAgICAgIGlmIChlbGVtZW50KSByZXR1cm4gZWxlbWVudDsKICAgIH0gY2F0Y2ggeyAvKiBzZWxlY3RvciBtYXkgYmUgaW52YWxpZCAtIGNvbnRpbnVlICovIH0KCiAgICAvLyBTZWFyY2ggc2hhZG93IHJvb3RzCiAgICBjb25zdCBhbGxFbGVtZW50cyA9IHJvb3QucXVlcnlTZWxlY3RvckFsbCgnKicpOwogICAgZm9yIChjb25zdCBlbCBvZiBhbGxFbGVtZW50cykgewogICAgICBpZiAoZWwuc2hhZG93Um9vdCkgewogICAgICAgIGNvbnN0IGZvdW5kID0gcXVlcnlTZWxlY3RvckRlZXAoc2VsZWN0b3IsIGVsLnNoYWRvd1Jvb3QpOwogICAgICAgIGlmIChmb3VuZCkgcmV0dXJuIGZvdW5kOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIG51bGw7CiAgfQoKICAvLyBHZXQgYWxsIGludGVyYWN0aXZlIGVsZW1lbnRzIGluY2x1ZGluZyB0aG9zZSBpbiBzaGFkb3cgRE9NCiAgZnVuY3Rpb24gZ2V0QWxsSW50ZXJhY3RpdmVFbGVtZW50cygpIHsKICAgIGNvbnN0IHJlc3VsdHMgPSBbXTsKCiAgICBmdW5jdGlvbiB0cmF2ZXJzZShyb290KSB7CiAgICAgIC8vIFF1ZXJ5IGludGVyYWN0aXZlIGVsZW1lbnRzIGluIHRoaXMgcm9vdAogICAgICBjb25zdCBpbnRlcmFjdGl2ZVNlbGVjdG9ycyA9IElOVEVSQUNUSVZFX1NFTEVDVE9SUyArICcsICcgKyBIRUFESU5HX1NFTEVDVE9SUzsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBlbGVtZW50cyA9IHJvb3QucXVlcnlTZWxlY3RvckFsbChpbnRlcmFjdGl2ZVNlbGVjdG9ycyk7CiAgICAgICAgcmVzdWx0cy5wdXNoKC4uLmVsZW1lbnRzKTsKICAgICAgfSBjYXRjaCB7IC8qIHNlbGVjdG9yIG1heSBiZSBpbnZhbGlkIC0gY29udGludWUgKi8gfQoKICAgICAgLy8gVHJhdmVyc2Ugc2hhZG93IHJvb3RzCiAgICAgIGNvbnN0IGFsbEVsZW1lbnRzID0gcm9vdC5xdWVyeVNlbGVjdG9yQWxsKCcqJyk7CiAgICAgIGZvciAoY29uc3QgZWwgb2YgYWxsRWxlbWVudHMpIHsKICAgICAgICBpZiAoZWwuc2hhZG93Um9vdCkgewogICAgICAgICAgdHJhdmVyc2UoZWwuc2hhZG93Um9vdCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgdHJhdmVyc2UoZG9jdW1lbnQpOwogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQoKICAvLyBHZXQgdGhlICJsaWdodCBET00iIHRleHQgY29udGVudCAoZXhjbHVkZXMgc2hhZG93IERPTSBpbnRlcm5hbCB0ZXh0KQogIGZ1bmN0aW9uIGdldFZpc2libGVUZXh0KGVsKSB7CiAgICAvLyBGb3IgZWxlbWVudHMgd2l0aCBzaGFkb3cgRE9NLCBnZXQgc2xvdHRlZCBjb250ZW50IG9yIGZhbGxiYWNrCiAgICBpZiAoZWwuc2hhZG93Um9vdCkgewogICAgICBjb25zdCBzbG90ID0gZWwuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKCdzbG90Jyk7CiAgICAgIGlmIChzbG90KSB7CiAgICAgICAgY29uc3QgYXNzaWduZWQgPSBzbG90LmFzc2lnbmVkTm9kZXMoKTsKICAgICAgICBpZiAoYXNzaWduZWQubGVuZ3RoID4gMCkgewogICAgICAgICAgcmV0dXJuIGFzc2lnbmVkLm1hcChuID0+IG4udGV4dENvbnRlbnQgfHwgJycpLmpvaW4oJycpLnRyaW0oKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBlbC50ZXh0Q29udGVudD8udHJpbSgpIHx8ICcnOwogIH0KCiAgLy8gTm9ybWFsaXplIHRleHQgZm9yIGNvbXBhcmlzb24gLSBoYW5kbGVzIHdoaXRlc3BhY2UsIGhpZGRlbiBjaGFycwogIGZ1bmN0aW9uIG5vcm1hbGl6ZVRleHQodGV4dCkgewogICAgaWYgKCF0ZXh0KSByZXR1cm4gJyc7CiAgICByZXR1cm4gdGV4dAogICAgICAucmVwbGFjZSgvW1xzXHUwMEEwXHUyMDBCXSsvZywgJyAnKSAgLy8gTm9ybWFsaXplIGFsbCB3aGl0ZXNwYWNlIGluY2x1ZGluZyBuYnNwLCB6ZXJvLXdpZHRoCiAgICAgIC50cmltKCkKICAgICAgLnRvTG93ZXJDYXNlKCk7CiAgfQoKICAvLyBDaGVjayBpZiBlbGVtZW50IGlzIHRydWx5IGludGVyYWN0aXZlCiAgZnVuY3Rpb24gaXNJbnRlcmFjdGl2ZShlbCkgewogICAgaWYgKCFlbCkgcmV0dXJuIGZhbHNlOwogICAgY29uc3QgdGFnID0gZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgY29uc3Qgcm9sZSA9IGVsLmdldEF0dHJpYnV0ZSgncm9sZScpOwogICAgY29uc3QgdGFiaW5kZXggPSBlbC5nZXRBdHRyaWJ1dGUoJ3RhYmluZGV4Jyk7CgogICAgLy8gRGlyZWN0IGludGVyYWN0aXZlIGVsZW1lbnRzCiAgICBpZiAoWydidXR0b24nLCAnYScsICdpbnB1dCcsICdzZWxlY3QnLCAndGV4dGFyZWEnXS5pbmNsdWRlcyh0YWcpKSByZXR1cm4gdHJ1ZTsKICAgIC8vIFJvbGUtYmFzZWQgaW50ZXJhY3RpdmUKICAgIGlmIChbJ2J1dHRvbicsICdsaW5rJywgJ2NoZWNrYm94JywgJ3JhZGlvJywgJ3RhYicsICdtZW51aXRlbScsICdvcHRpb24nLCAnc3dpdGNoJ10uaW5jbHVkZXMocm9sZSkpIHJldHVybiB0cnVlOwogICAgLy8gRm9jdXNhYmxlIGVsZW1lbnRzCiAgICBpZiAodGFiaW5kZXggJiYgdGFiaW5kZXggIT09ICctMScpIHJldHVybiB0cnVlOwogICAgLy8gTGFiZWxzIHdpdGggZm9yIGF0dHJpYnV0ZQogICAgaWYgKHRhZyA9PT0gJ2xhYmVsJyAmJiBlbC5nZXRBdHRyaWJ1dGUoJ2ZvcicpKSByZXR1cm4gdHJ1ZTsKICAgIC8vIEN1c3RvbSBlbGVtZW50cyB0aGF0IGFyZSB0eXBpY2FsbHkgaW50ZXJhY3RpdmUKICAgIGlmICh0YWcuaW5jbHVkZXMoJy0nKSAmJiAoZWwub25jbGljayB8fCBlbC5nZXRBdHRyaWJ1dGUoJ29uY2xpY2snKSkpIHJldHVybiB0cnVlOwoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIC8vIENoZWNrIGlmIGVsZW1lbnQgaXMgdmlzaWJsZSBhbmQgaGFzIGRpbWVuc2lvbnMgKHdpdGggY2FjaGluZyBmb3IgcGVyZm9ybWFuY2UpCiAgY29uc3QgdmlzaWJpbGl0eUNhY2hlID0gbmV3IFdlYWtNYXAoKTsKICBmdW5jdGlvbiBpc1Zpc2libGUoZWwpIHsKICAgIGlmICh2aXNpYmlsaXR5Q2FjaGUuaGFzKGVsKSkgcmV0dXJuIHZpc2liaWxpdHlDYWNoZS5nZXQoZWwpOwoKICAgIGNvbnN0IHJlY3QgPSBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIGlmIChyZWN0LndpZHRoID09PSAwIHx8IHJlY3QuaGVpZ2h0ID09PSAwKSB7CiAgICAgIHZpc2liaWxpdHlDYWNoZS5zZXQoZWwsIGZhbHNlKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIE9ubHkgY2hlY2sgY29tcHV0ZWQgc3R5bGUgZm9yIGVsZW1lbnRzIHRoYXQgcGFzcyBzaXplIGNoZWNrIChleHBlbnNpdmUgb3BlcmF0aW9uKQogICAgY29uc3Qgc3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbCk7CiAgICBjb25zdCB2aXNpYmxlID0gc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnICYmCiAgICAgICAgICAgICAgICAgICBzdHlsZS52aXNpYmlsaXR5ICE9PSAnaGlkZGVuJyAmJgogICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdChzdHlsZS5vcGFjaXR5KSA+IDA7CgogICAgdmlzaWJpbGl0eUNhY2hlLnNldChlbCwgdmlzaWJsZSk7CiAgICByZXR1cm4gdmlzaWJsZTsKICB9CgogIC8vIENSSVRJQ0FMIEZJWDogQ2hlY2sgaWYgYSBjb250YWluZXIgaGFzIGFuIGludGVyYWN0aXZlIGNoaWxkIHRoYXQgbWF0Y2hlcyB0aGUgdGV4dAogIC8vIFRoaXMgcHJldmVudHMgY2xpY2tpbmcgd3JhcHBlciBkaXZzIHdoZW4gdGhlIGFjdHVhbCBidXR0b24gaXMgaW5zaWRlCiAgZnVuY3Rpb24gZmluZEludGVyYWN0aXZlQ2hpbGRXaXRoVGV4dChjb250YWluZXIsIHNlYXJjaFRleHQpIHsKICAgIGNvbnN0IG5vcm1hbGl6ZWRTZWFyY2ggPSBub3JtYWxpemVUZXh0KHNlYXJjaFRleHQpOwogICAgY29uc3QgaW50ZXJhY3RpdmVDaGlsZHJlbiA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKElOVEVSQUNUSVZFX1NFTEVDVE9SUyk7CgogICAgZm9yIChjb25zdCBjaGlsZCBvZiBpbnRlcmFjdGl2ZUNoaWxkcmVuKSB7CiAgICAgIGlmICghaXNWaXNpYmxlKGNoaWxkKSkgY29udGludWU7CiAgICAgIGNvbnN0IGNoaWxkVGV4dCA9IG5vcm1hbGl6ZVRleHQoY2hpbGQudGV4dENvbnRlbnQpOwogICAgICAvLyBDaGVjayBleGFjdCBtYXRjaCBmaXJzdAogICAgICBpZiAoY2hpbGRUZXh0ID09PSBub3JtYWxpemVkU2VhcmNoKSByZXR1cm4gY2hpbGQ7CiAgICB9CiAgICAvLyBUaGVuIHBhcnRpYWwgbWF0Y2gKICAgIGZvciAoY29uc3QgY2hpbGQgb2YgaW50ZXJhY3RpdmVDaGlsZHJlbikgewogICAgICBpZiAoIWlzVmlzaWJsZShjaGlsZCkpIGNvbnRpbnVlOwogICAgICBjb25zdCBjaGlsZFRleHQgPSBub3JtYWxpemVUZXh0KGNoaWxkLnRleHRDb250ZW50KTsKICAgICAgaWYgKGNoaWxkVGV4dC5pbmNsdWRlcyhub3JtYWxpemVkU2VhcmNoKSkgcmV0dXJuIGNoaWxkOwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQoKICAvLyBTY29yZSBlbGVtZW50IHNwZWNpZmljaXR5IC0gbG93ZXIgaXMgYmV0dGVyIChtb3JlIHNwZWNpZmljKQogIGZ1bmN0aW9uIHNjb3JlRWxlbWVudChlbCkgewogICAgY29uc3QgcmVjdCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgbGV0IHNjb3JlID0gcmVjdC53aWR0aCAqIHJlY3QuaGVpZ2h0OwoKICAgIC8vIFNUUk9OR0xZIHByZWZlciBpbnRlcmFjdGl2ZSBlbGVtZW50cwogICAgaWYgKGlzSW50ZXJhY3RpdmUoZWwpKSB7CiAgICAgIHNjb3JlICo9IDAuMDAxOyAgLy8gMTAwMHggcHJlZmVyZW5jZSBmb3IgaW50ZXJhY3RpdmUgZWxlbWVudHMKICAgIH0KCiAgICAvLyBQcmVmZXIgZWxlbWVudHMgd2l0aCBsZXNzIHRleHQgKG1vcmUgc3BlY2lmaWMgbWF0Y2gpCiAgICBjb25zdCB0ZXh0TGVuZ3RoID0gZWwudGV4dENvbnRlbnQ/Lmxlbmd0aCB8fCAwOwogICAgc2NvcmUgKz0gdGV4dExlbmd0aCAqIDAuMTsKCiAgICAvLyBQcmVmZXIgZGVlcGVyIGVsZW1lbnRzIChjaGlsZHJlbiBvdmVyIHBhcmVudHMpCiAgICBsZXQgZGVwdGggPSAwOwogICAgbGV0IHBhcmVudCA9IGVsLnBhcmVudEVsZW1lbnQ7CiAgICB3aGlsZSAocGFyZW50ICYmIGRlcHRoIDwgMjApIHsKICAgICAgZGVwdGgrKzsKICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudEVsZW1lbnQ7CiAgICB9CiAgICBzY29yZSAtPSBkZXB0aCAqIDEwOyAgLy8gRGVlcGVyID0gbG93ZXIgc2NvcmUgPSBiZXR0ZXIKCiAgICByZXR1cm4gc2NvcmU7CiAgfQoKICBmdW5jdGlvbiBmaW5kRWxlbWVudChzZWxlY3Rvciwgb3B0aW9ucyA9IHt9KSB7CiAgICBpZiAoIXNlbGVjdG9yKSByZXR1cm4gbnVsbDsKICAgIGNvbnN0IHsgc3RyaWN0SW50ZXJhY3RpdmUgPSBmYWxzZSB9ID0gb3B0aW9uczsKCiAgICAvLyBFc2NhcGUgc3BlY2lhbCBDU1MgY2hhcmFjdGVycyBmb3IgcXVlcnlTZWxlY3RvcgogICAgY29uc3QgZXNjYXBlZFNlbGVjdG9yID0gc2VsZWN0b3IucmVwbGFjZSgvKFshIiMkJSYnKCkqKywuLzo7PD0+P0BbXFxdXlxge3x9fl0pL2csICdcXCQxJyk7CiAgICBjb25zdCBub3JtYWxpemVkU2VsZWN0b3IgPSBub3JtYWxpemVUZXh0KHNlbGVjdG9yKTsKCiAgICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICAgIC8vIFNUUkFURUdZIDE6IFBsYXl3cmlnaHQtc3R5bGUgcm9sZS90ZXh0IGxvY2F0b3JzCiAgICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKCiAgICAvLyBTdXBwb3J0ICJyb2xlOmJ1dHRvbiIgb3IgImJ1dHRvbjpBZGQiIHN5bnRheAogICAgY29uc3Qgcm9sZU1hdGNoID0gc2VsZWN0b3IubWF0Y2goL14ocm9sZXxidXR0b258bGlua3xpbnB1dHx0ZXh0KTooLispJC9pKTsKICAgIGlmIChyb2xlTWF0Y2gpIHsKICAgICAgY29uc3QgWywgdHlwZSwgdmFsdWVdID0gcm9sZU1hdGNoOwogICAgICBjb25zdCBub3JtYWxpemVkVmFsdWUgPSBub3JtYWxpemVUZXh0KHZhbHVlKTsKCiAgICAgIGlmICh0eXBlLnRvTG93ZXJDYXNlKCkgPT09ICdyb2xlJyB8fCB0eXBlLnRvTG93ZXJDYXNlKCkgPT09ICdidXR0b24nKSB7CiAgICAgICAgLy8gU2VhcmNoIGJ1dHRvbnMgaW5jbHVkaW5nIHNoYWRvdyBET00KICAgICAgICBjb25zdCBidXR0b25zID0gcXVlcnlTZWxlY3RvckFsbERlZXAoJ2J1dHRvbiwgW3JvbGU9ImJ1dHRvbiJdJyk7CiAgICAgICAgZm9yIChjb25zdCBidG4gb2YgYnV0dG9ucykgewogICAgICAgICAgaWYgKCFpc1Zpc2libGUoYnRuKSkgY29udGludWU7CiAgICAgICAgICBpZiAobm9ybWFsaXplVGV4dChnZXRWaXNpYmxlVGV4dChidG4pKSA9PT0gbm9ybWFsaXplZFZhbHVlKSByZXR1cm4gYnRuOwogICAgICAgIH0KICAgICAgICBmb3IgKGNvbnN0IGJ0biBvZiBidXR0b25zKSB7CiAgICAgICAgICBpZiAoIWlzVmlzaWJsZShidG4pKSBjb250aW51ZTsKICAgICAgICAgIGlmIChub3JtYWxpemVUZXh0KGdldFZpc2libGVUZXh0KGJ0bikpLmluY2x1ZGVzKG5vcm1hbGl6ZWRWYWx1ZSkpIHJldHVybiBidG47CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0eXBlLnRvTG93ZXJDYXNlKCkgPT09ICdsaW5rJykgewogICAgICAgIGNvbnN0IGxpbmtzID0gcXVlcnlTZWxlY3RvckFsbERlZXAoJ2EsIFtyb2xlPSJsaW5rIl0nKTsKICAgICAgICBmb3IgKGNvbnN0IGxpbmsgb2YgbGlua3MpIHsKICAgICAgICAgIGlmICghaXNWaXNpYmxlKGxpbmspKSBjb250aW51ZTsKICAgICAgICAgIGlmIChub3JtYWxpemVUZXh0KGdldFZpc2libGVUZXh0KGxpbmspKSA9PT0gbm9ybWFsaXplZFZhbHVlKSByZXR1cm4gbGluazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ2lucHV0JykgewogICAgICAgIGNvbnN0IGlucHV0cyA9IHF1ZXJ5U2VsZWN0b3JBbGxEZWVwKCdpbnB1dCwgdGV4dGFyZWEsIHNlbGVjdCcpOwogICAgICAgIGZvciAoY29uc3QgaW5wdXQgb2YgaW5wdXRzKSB7CiAgICAgICAgICBpZiAoIWlzVmlzaWJsZShpbnB1dCkpIGNvbnRpbnVlOwogICAgICAgICAgY29uc3QgbGFiZWwgPSBpbnB1dC5nZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnKSB8fCBpbnB1dC5wbGFjZWhvbGRlciB8fCBpbnB1dC5uYW1lIHx8ICcnOwogICAgICAgICAgaWYgKG5vcm1hbGl6ZVRleHQobGFiZWwpID09PSBub3JtYWxpemVkVmFsdWUgfHwgbm9ybWFsaXplVGV4dChsYWJlbCkuaW5jbHVkZXMobm9ybWFsaXplZFZhbHVlKSkgewogICAgICAgICAgICByZXR1cm4gaW5wdXQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0eXBlLnRvTG93ZXJDYXNlKCkgPT09ICd0ZXh0JykgewogICAgICAgIC8vIEZhbGwgdGhyb3VnaCB0byB0ZXh0IHNlYXJjaCB3aXRoIHRoaXMgdmFsdWUKICAgICAgICBzZWxlY3RvciA9IHZhbHVlOwogICAgICB9CiAgICB9CgogICAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgICAvLyBTVFJBVEVHWSAyOiBEaXJlY3QgQ1NTIHNlbGVjdG9yIChpZiBpdCBsb29rcyBsaWtlIG9uZSkKICAgIC8vIFVzZXMgZGVlcCBxdWVyeSB0byBzZWFyY2ggc2hhZG93IERPTSB0b28KICAgIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKICAgIGlmICgvXlsuI1xcW10vLnRlc3Qoc2VsZWN0b3IpIHx8IC9eW2Etel1bYS16MC05LV0qJC9pLnRlc3Qoc2VsZWN0b3IpKSB7CiAgICAgIHRyeSB7CiAgICAgICAgLy8gVHJ5IHJlZ3VsYXIgRE9NIGZpcnN0IChmYXN0ZXIpLCB0aGVuIHNoYWRvdyBET00KICAgICAgICBsZXQgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpOwogICAgICAgIGlmICghZWxlbWVudCkgewogICAgICAgICAgZWxlbWVudCA9IHF1ZXJ5U2VsZWN0b3JEZWVwKHNlbGVjdG9yKTsKICAgICAgICB9CiAgICAgICAgaWYgKGVsZW1lbnQgJiYgaXNWaXNpYmxlKGVsZW1lbnQpKSB7CiAgICAgICAgICAvLyBDUklUSUNBTDogSWYgd2UgZm91bmQgYSBjb250YWluZXIsIGNoZWNrIGZvciBpbnRlcmFjdGl2ZSBjaGlsZAogICAgICAgICAgaWYgKCFpc0ludGVyYWN0aXZlKGVsZW1lbnQpKSB7CiAgICAgICAgICAgIGNvbnN0IGludGVyYWN0aXZlQ2hpbGQgPSBmaW5kSW50ZXJhY3RpdmVDaGlsZFdpdGhUZXh0KGVsZW1lbnQsIGVsZW1lbnQudGV4dENvbnRlbnQpOwogICAgICAgICAgICBpZiAoaW50ZXJhY3RpdmVDaGlsZCkgcmV0dXJuIGludGVyYWN0aXZlQ2hpbGQ7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZWxlbWVudDsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAvLyBJbnZhbGlkIHNlbGVjdG9yLCBjb250aW51ZSB0byB0ZXh0IHNlYXJjaAogICAgICB9CiAgICB9CgogICAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgICAvLyBTVFJBVEVHWSAzOiBUZXh0LWJhc2VkIHNlYXJjaCB3aXRoIFNUUklDVCBpbnRlcmFjdGl2ZSBwcmVmZXJlbmNlCiAgICAvLyBTZWFyY2hlcyBBTEwgZWxlbWVudHMgaW5jbHVkaW5nIHNoYWRvdyBET00KICAgIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKICAgIC8vIFVzZSBkZWVwIHRyYXZlcnNhbCB0byBpbmNsdWRlIHNoYWRvdyBET00gZWxlbWVudHMKICAgIGNvbnN0IGFsbEVsZW1lbnRzID0gZ2V0QWxsSW50ZXJhY3RpdmVFbGVtZW50cygpOwogICAgbGV0IGNhbmRpZGF0ZXMgPSBbXTsKCiAgICBmb3IgKGNvbnN0IGVsIG9mIGFsbEVsZW1lbnRzKSB7CiAgICAgIGlmICghaXNWaXNpYmxlKGVsKSkgY29udGludWU7CgogICAgICAvLyBVc2UgZ2V0VmlzaWJsZVRleHQgZm9yIHByb3BlciBzaGFkb3cgRE9NIGhhbmRsaW5nCiAgICAgIGNvbnN0IHRleHQgPSBub3JtYWxpemVUZXh0KGdldFZpc2libGVUZXh0KGVsKSk7CiAgICAgIGNvbnN0IGFyaWFMYWJlbCA9IG5vcm1hbGl6ZVRleHQoZWwuZ2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJykgfHwgJycpOwoKICAgICAgLy8gTWF0Y2ggYWdhaW5zdCB2aXNpYmxlIHRleHQgT1IgYXJpYS1sYWJlbAogICAgICBjb25zdCBpc0V4YWN0ID0gdGV4dCA9PT0gbm9ybWFsaXplZFNlbGVjdG9yIHx8IGFyaWFMYWJlbCA9PT0gbm9ybWFsaXplZFNlbGVjdG9yOwogICAgICBjb25zdCBpc1BhcnRpYWwgPSAhaXNFeGFjdCAmJiAodGV4dC5pbmNsdWRlcyhub3JtYWxpemVkU2VsZWN0b3IpIHx8IGFyaWFMYWJlbC5pbmNsdWRlcyhub3JtYWxpemVkU2VsZWN0b3IpKTsKCiAgICAgIGlmIChpc0V4YWN0IHx8IGlzUGFydGlhbCkgewogICAgICAgIGNhbmRpZGF0ZXMucHVzaCh7CiAgICAgICAgICBlbGVtZW50OiBlbCwKICAgICAgICAgIGlzRXhhY3QsCiAgICAgICAgICBpc0ludGVyYWN0aXZlOiBpc0ludGVyYWN0aXZlKGVsKSwKICAgICAgICAgIHNjb3JlOiBzY29yZUVsZW1lbnQoZWwpCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBTb3J0IGNhbmRpZGF0ZXMgYnkgcHJpb3JpdHk6CiAgICAvLyAxLiBJbnRlcmFjdGl2ZSArIEV4YWN0IG1hdGNoIChiZXN0KQogICAgLy8gMi4gSW50ZXJhY3RpdmUgKyBQYXJ0aWFsIG1hdGNoCiAgICAvLyAzLiBOb24taW50ZXJhY3RpdmUgKyBFeGFjdCBtYXRjaAogICAgLy8gNC4gTm9uLWludGVyYWN0aXZlICsgUGFydGlhbCBtYXRjaAogICAgY2FuZGlkYXRlcy5zb3J0KChhLCBiKSA9PiB7CiAgICAgIC8vIEludGVyYWN0aXZlIGFsd2F5cyBiZWF0cyBub24taW50ZXJhY3RpdmUKICAgICAgaWYgKGEuaXNJbnRlcmFjdGl2ZSAhPT0gYi5pc0ludGVyYWN0aXZlKSB7CiAgICAgICAgcmV0dXJuIGEuaXNJbnRlcmFjdGl2ZSA/IC0xIDogMTsKICAgICAgfQogICAgICAvLyBFeGFjdCBiZWF0cyBwYXJ0aWFsCiAgICAgIGlmIChhLmlzRXhhY3QgIT09IGIuaXNFeGFjdCkgewogICAgICAgIHJldHVybiBhLmlzRXhhY3QgPyAtMSA6IDE7CiAgICAgIH0KICAgICAgLy8gTG93ZXIgc2NvcmUgaXMgYmV0dGVyCiAgICAgIHJldHVybiBhLnNjb3JlIC0gYi5zY29yZTsKICAgIH0pOwoKICAgIC8vIENSSVRJQ0FMIEZJWDogQmVmb3JlIHJldHVybmluZyBhbnkgbm9uLWludGVyYWN0aXZlIGVsZW1lbnQsCiAgICAvLyBjaGVjayBpZiBpdCBoYXMgYW4gaW50ZXJhY3RpdmUgY2hpbGQgdGhhdCBtYXRjaGVzCiAgICBmb3IgKGNvbnN0IGNhbmRpZGF0ZSBvZiBjYW5kaWRhdGVzKSB7CiAgICAgIGNvbnN0IGVsID0gY2FuZGlkYXRlLmVsZW1lbnQ7CgogICAgICAvLyBJZiBpbnRlcmFjdGl2ZSwgcmV0dXJuIGl0IGRpcmVjdGx5CiAgICAgIGlmIChjYW5kaWRhdGUuaXNJbnRlcmFjdGl2ZSkgewogICAgICAgIHJldHVybiBlbDsKICAgICAgfQoKICAgICAgLy8gSWYgc3RyaWN0IG1vZGUgYW5kIG5vdCBpbnRlcmFjdGl2ZSwgc2tpcAogICAgICBpZiAoc3RyaWN0SW50ZXJhY3RpdmUpIGNvbnRpbnVlOwoKICAgICAgLy8gRm9yIG5vbi1pbnRlcmFjdGl2ZSBjb250YWluZXJzLCBBTFdBWVMgY2hlY2sgZm9yIGludGVyYWN0aXZlIGNoaWxkcmVuCiAgICAgIGNvbnN0IGludGVyYWN0aXZlQ2hpbGQgPSBmaW5kSW50ZXJhY3RpdmVDaGlsZFdpdGhUZXh0KGVsLCBzZWxlY3Rvcik7CiAgICAgIGlmIChpbnRlcmFjdGl2ZUNoaWxkKSB7CiAgICAgICAgcmV0dXJuIGludGVyYWN0aXZlQ2hpbGQ7ICAvLyBSZXR1cm4gdGhlIGJ1dHRvbi9saW5rIGluc2lkZSwgbm90IHRoZSBjb250YWluZXIKICAgICAgfQoKICAgICAgLy8gT25seSByZXR1cm4gY29udGFpbmVyIGlmIG5vIGludGVyYWN0aXZlIGNoaWxkIGV4aXN0cwogICAgICAvLyAoZS5nLiwgY2xpY2tpbmcgYSBoZWFkaW5nIG9yIHBhcmFncmFwaCBpcyBzb21ldGltZXMgdmFsaWQpCiAgICAgIGlmICghc3RyaWN0SW50ZXJhY3RpdmUpIHsKICAgICAgICByZXR1cm4gZWw7CiAgICAgIH0KICAgIH0KCiAgICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICAgIC8vIFNUUkFURUdZIDQ6IEF0dHJpYnV0ZS1iYXNlZCBmYWxsYmFja3MKICAgIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKICAgIC8vIGFyaWEtbGFiZWwKICAgIHRyeSB7CiAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbYXJpYS1sYWJlbCo9IicgKyBlc2NhcGVkU2VsZWN0b3IgKyAnIiBpXScpOwogICAgICBpZiAoZWxlbWVudCAmJiBpc1Zpc2libGUoZWxlbWVudCkpIHJldHVybiBlbGVtZW50OwogICAgfSBjYXRjaCB7IC8qIHNlbGVjdG9yIG1heSBiZSBpbnZhbGlkIC0gY29udGludWUgKi8gfQoKICAgIC8vIHBsYWNlaG9sZGVyCiAgICB0cnkgewogICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW3BsYWNlaG9sZGVyKj0iJyArIGVzY2FwZWRTZWxlY3RvciArICciIGldJyk7CiAgICAgIGlmIChlbGVtZW50ICYmIGlzVmlzaWJsZShlbGVtZW50KSkgcmV0dXJuIGVsZW1lbnQ7CiAgICB9IGNhdGNoIHsgLyogc2VsZWN0b3IgbWF5IGJlIGludmFsaWQgLSBjb250aW51ZSAqLyB9CgogICAgLy8gZGF0YS10ZXN0aWQKICAgIHRyeSB7CiAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS10ZXN0aWQqPSInICsgZXNjYXBlZFNlbGVjdG9yICsgJyIgaV0nKTsKICAgICAgaWYgKGVsZW1lbnQgJiYgaXNWaXNpYmxlKGVsZW1lbnQpKSByZXR1cm4gZWxlbWVudDsKICAgIH0gY2F0Y2ggeyAvKiBzZWxlY3RvciBtYXkgYmUgaW52YWxpZCAtIGNvbnRpbnVlICovIH0KCiAgICAvLyBpbnB1dCB2YWx1ZQogICAgdHJ5IHsKICAgICAgY29uc3QgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnaW5wdXQsIHRleHRhcmVhJyk7CiAgICAgIGZvciAoY29uc3QgZWwgb2YgaW5wdXRzKSB7CiAgICAgICAgaWYgKCFpc1Zpc2libGUoZWwpKSBjb250aW51ZTsKICAgICAgICBpZiAoZWwudmFsdWU/LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VsZWN0b3IudG9Mb3dlckNhc2UoKSkpIHsKICAgICAgICAgIHJldHVybiBlbDsKICAgICAgICB9CiAgICAgIH0KICAgIH0gY2F0Y2ggeyAvKiBzZWxlY3RvciBtYXkgYmUgaW52YWxpZCAtIGNvbnRpbnVlICovIH0KCiAgICByZXR1cm4gbnVsbDsKICB9CgogIC8vIEV4dGVuZGVkIGZpbmRFbGVtZW50IHRoYXQgcmV0dXJucyBtZXRhZGF0YSBhYm91dCB0aGUgc2VhcmNoCiAgZnVuY3Rpb24gZmluZEVsZW1lbnRXaXRoTWV0YWRhdGEoc2VsZWN0b3IsIG9wdGlvbnMgPSB7fSkgewogICAgY29uc3Qgbm9ybWFsaXplZFNlbGVjdG9yID0gbm9ybWFsaXplVGV4dChzZWxlY3Rvcik7CiAgICBjb25zdCBhbGxFbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoSU5URVJBQ1RJVkVfU0VMRUNUT1JTICsgJywgJyArIEhFQURJTkdfU0VMRUNUT1JTICsgJywgJyArIENPTlRBSU5FUl9TRUxFQ1RPUlMpOwoKICAgIGxldCBtYXRjaENvdW50ID0gMDsKICAgIGxldCBpbnRlcmFjdGl2ZU1hdGNoQ291bnQgPSAwOwoKICAgIGZvciAoY29uc3QgZWwgb2YgYWxsRWxlbWVudHMpIHsKICAgICAgaWYgKCFpc1Zpc2libGUoZWwpKSBjb250aW51ZTsKICAgICAgY29uc3QgdGV4dCA9IG5vcm1hbGl6ZVRleHQoZWwudGV4dENvbnRlbnQpOwogICAgICBpZiAodGV4dCA9PT0gbm9ybWFsaXplZFNlbGVjdG9yIHx8IHRleHQuaW5jbHVkZXMobm9ybWFsaXplZFNlbGVjdG9yKSkgewogICAgICAgIG1hdGNoQ291bnQrKzsKICAgICAgICBpZiAoaXNJbnRlcmFjdGl2ZShlbCkpIGludGVyYWN0aXZlTWF0Y2hDb3VudCsrOwogICAgICB9CiAgICB9CgogICAgY29uc3QgZWxlbWVudCA9IGZpbmRFbGVtZW50KHNlbGVjdG9yLCBvcHRpb25zKTsKCiAgICByZXR1cm4gewogICAgICBlbGVtZW50LAogICAgICBtYXRjaENvdW50LAogICAgICBpbnRlcmFjdGl2ZU1hdGNoQ291bnQsCiAgICAgIGlzQW1iaWd1b3VzOiBtYXRjaENvdW50ID4gMSwKICAgICAgc2VsZWN0ZWRJc0ludGVyYWN0aXZlOiBlbGVtZW50ID8gaXNJbnRlcmFjdGl2ZShlbGVtZW50KSA6IGZhbHNlCiAgICB9OwogIH0KCiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgLy8gVklTVUFMIEZFRURCQUNLCiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCgogIGZ1bmN0aW9uIHNob3dIaWdobGlnaHQoZWxlbWVudCwgYWN0aW9uKSB7CiAgICBjb25zdCByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIGNvbnN0IGhpZ2hsaWdodCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgaGlnaGxpZ2h0LmNsYXNzTmFtZSA9ICd2aWJlLWFpLWhpZ2hsaWdodCc7CiAgICBoaWdobGlnaHQuc2V0QXR0cmlidXRlKCdkYXRhLWFjdGlvbicsIGFjdGlvbik7CiAgICBoaWdobGlnaHQuc3R5bGUuY3NzVGV4dCA9IGAKICAgICAgdG9wOiAke3JlY3QudG9wICsgd2luZG93LnNjcm9sbFkgLSA0fXB4OwogICAgICBsZWZ0OiAke3JlY3QubGVmdCArIHdpbmRvdy5zY3JvbGxYIC0gNH1weDsKICAgICAgd2lkdGg6ICR7cmVjdC53aWR0aCArIDh9cHg7CiAgICAgIGhlaWdodDogJHtyZWN0LmhlaWdodCArIDh9cHg7CiAgICBgOwogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChoaWdobGlnaHQpOwoKICAgIC8vIFJlbW92ZSBhZnRlciBhbmltYXRpb24KICAgIHNldFRpbWVvdXQoKCkgPT4gaGlnaGxpZ2h0LnJlbW92ZSgpLCAxNTAwKTsKICAgIHJldHVybiBoaWdobGlnaHQ7CiAgfQoKICBmdW5jdGlvbiBzaG93Q2xpY2tSaXBwbGUoeCwgeSkgewogICAgY29uc3QgcmlwcGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICByaXBwbGUuY2xhc3NOYW1lID0gJ3ZpYmUtYWktY2xpY2stcmlwcGxlJzsKICAgIHJpcHBsZS5zdHlsZS5jc3NUZXh0ID0gYAogICAgICB0b3A6ICR7eSArIHdpbmRvdy5zY3JvbGxZfXB4OwogICAgICBsZWZ0OiAke3ggKyB3aW5kb3cuc2Nyb2xsWH1weDsKICAgIGA7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHJpcHBsZSk7CiAgICBzZXRUaW1lb3V0KCgpID0+IHJpcHBsZS5yZW1vdmUoKSwgNTAwKTsKICB9CgogIGZ1bmN0aW9uIHNob3dUeXBpbmdJbmRpY2F0b3IoZWxlbWVudCwgdGV4dCkgewogICAgY29uc3QgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICBjb25zdCBpbmRpY2F0b3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGluZGljYXRvci5jbGFzc05hbWUgPSAndmliZS1haS10eXBpbmcnOwogICAgaW5kaWNhdG9yLnRleHRDb250ZW50ID0gdGV4dC5sZW5ndGggPiAzMCA/IHRleHQuc2xpY2UoMCwgMzApICsgJy4uLicgOiB0ZXh0OwogICAgaW5kaWNhdG9yLnN0eWxlLmNzc1RleHQgPSBgCiAgICAgIHRvcDogJHtyZWN0LmJvdHRvbSArIHdpbmRvdy5zY3JvbGxZICsgOH1weDsKICAgICAgbGVmdDogJHtyZWN0LmxlZnQgKyB3aW5kb3cuc2Nyb2xsWH1weDsKICAgIGA7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGluZGljYXRvcik7CiAgICBzZXRUaW1lb3V0KCgpID0+IGluZGljYXRvci5yZW1vdmUoKSwgMjAwMCk7CiAgfQoKICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICAvLyBBQ1RJT05TIC0gV0lUSCBWRVJJRklDQVRJT04gQU5EIERFVEFJTEVEIE1FVEFEQVRBCiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCgogIC8vIEdlbmVyYXRlIGEgdW5pcXVlIENTUyBzZWxlY3RvciBmb3IgYW4gZWxlbWVudCAoZm9yIGRlYnVnZ2luZy9yZXRyeSkKICBmdW5jdGlvbiBnZXRVbmlxdWVTZWxlY3RvcihlbCkgewogICAgaWYgKGVsLmlkKSByZXR1cm4gJyMnICsgZWwuaWQ7CgogICAgY29uc3QgdGFnID0gZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgbGV0IHNlbGVjdG9yID0gdGFnOwoKICAgIC8vIEFkZCBkaXN0aW5ndWlzaGluZyBjbGFzc2VzIChmaXJzdCAyLCBza2lwIHV0aWxpdHkgY2xhc3NlcykKICAgIGlmIChlbC5jbGFzc05hbWUgJiYgdHlwZW9mIGVsLmNsYXNzTmFtZSA9PT0gJ3N0cmluZycpIHsKICAgICAgY29uc3QgY2xhc3NlcyA9IGVsLmNsYXNzTmFtZS5zcGxpdCgnICcpCiAgICAgICAgLmZpbHRlcihjID0+IGMgJiYgIWMubWF0Y2goL14ocC18bS18dy18aC18ZmxleHxncmlkfHRleHQtfGJnLXxib3JkZXIpLykpCiAgICAgICAgLnNsaWNlKDAsIDIpOwogICAgICBpZiAoY2xhc3Nlcy5sZW5ndGgpIHNlbGVjdG9yICs9ICcuJyArIGNsYXNzZXMuam9pbignLicpOwogICAgfQoKICAgIC8vIEFkZCBpbmRleCBhbW9uZyBzaWJsaW5ncyBpZiBuZWVkZWQKICAgIGNvbnN0IHBhcmVudCA9IGVsLnBhcmVudEVsZW1lbnQ7CiAgICBpZiAocGFyZW50KSB7CiAgICAgIGNvbnN0IHNpYmxpbmdzID0gQXJyYXkuZnJvbShwYXJlbnQuY2hpbGRyZW4pLmZpbHRlcihjID0+IGMudGFnTmFtZSA9PT0gZWwudGFnTmFtZSk7CiAgICAgIGlmIChzaWJsaW5ncy5sZW5ndGggPiAxKSB7CiAgICAgICAgY29uc3QgaW5kZXggPSBzaWJsaW5ncy5pbmRleE9mKGVsKSArIDE7CiAgICAgICAgc2VsZWN0b3IgKz0gJzpudGgtb2YtdHlwZSgnICsgaW5kZXggKyAnKSc7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gc2VsZWN0b3I7CiAgfQoKICAvLyBXYWl0IGZvciBlbGVtZW50IHdpdGggcmV0cnkgKGhhbmRsZXMgYXN5bmMgcmVuZGVyaW5nKQogIGFzeW5jIGZ1bmN0aW9uIHdhaXRGb3JFbGVtZW50KHNlbGVjdG9yLCBvcHRpb25zID0ge30sIG1heFdhaXQgPSAyMDAwKSB7CiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpOwogICAgY29uc3QgcG9sbEludGVydmFsID0gMTAwOwoKICAgIHdoaWxlIChEYXRlLm5vdygpIC0gc3RhcnRUaW1lIDwgbWF4V2FpdCkgewogICAgICBjb25zdCByZXN1bHQgPSBmaW5kRWxlbWVudFdpdGhNZXRhZGF0YShzZWxlY3Rvciwgb3B0aW9ucyk7CiAgICAgIGlmIChyZXN1bHQuZWxlbWVudCkgcmV0dXJuIHJlc3VsdDsKICAgICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIHBvbGxJbnRlcnZhbCkpOwogICAgfQogICAgcmV0dXJuIGZpbmRFbGVtZW50V2l0aE1ldGFkYXRhKHNlbGVjdG9yLCBvcHRpb25zKTsgLy8gRmluYWwgYXR0ZW1wdAogIH0KCiAgYXN5bmMgZnVuY3Rpb24gcGVyZm9ybUNsaWNrKHNlbGVjdG9yLCBvcHRpb25zID0ge30pIHsKICAgIC8vIFVzZSByZXRyeS1hd2FyZSBmaW5kIGZvciBhc3luYyBjb250ZW50CiAgICBjb25zdCBzZWFyY2hSZXN1bHQgPSBhd2FpdCB3YWl0Rm9yRWxlbWVudChzZWxlY3Rvciwgb3B0aW9ucyk7CiAgICBjb25zdCB7IGVsZW1lbnQsIG1hdGNoQ291bnQsIGludGVyYWN0aXZlTWF0Y2hDb3VudCwgaXNBbWJpZ3VvdXMsIHNlbGVjdGVkSXNJbnRlcmFjdGl2ZSB9ID0gc2VhcmNoUmVzdWx0OwoKICAgIGlmICghZWxlbWVudCkgewogICAgICByZXR1cm4gewogICAgICAgIHN1Y2Nlc3M6IGZhbHNlLAogICAgICAgIGVycm9yOiAnRWxlbWVudCBub3QgZm91bmQgYWZ0ZXIgMnM6ICcgKyBzZWxlY3RvciwKICAgICAgICBzZWFyY2hEZXRhaWxzOiB7CiAgICAgICAgICBtYXRjaENvdW50OiAwLAogICAgICAgICAgc3VnZ2VzdGlvbjogJ1RyeSB1c2luZyBhIG1vcmUgc3BlY2lmaWMgc2VsZWN0b3IgbGlrZSAiYnV0dG9uOkFkZCIgb3IgY2hlY2sgdGhlIHNuYXBzaG90IGZvciBhdmFpbGFibGUgZWxlbWVudHMnCiAgICAgICAgfQogICAgICB9OwogICAgfQoKICAgIC8vIFZFUklGSUNBVElPTjogV2FybiBpZiBjbGlja2luZyBhIG5vbi1pbnRlcmFjdGl2ZSBlbGVtZW50CiAgICBjb25zdCB0YWcgPSBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTsKICAgIGNvbnN0IGlzQ2xpY2thYmxlVGFnID0gWydidXR0b24nLCAnYScsICdpbnB1dCcsICdzZWxlY3QnLCAndGV4dGFyZWEnLCAnbGFiZWwnXS5pbmNsdWRlcyh0YWcpOwogICAgY29uc3QgaGFzQ2xpY2tSb2xlID0gWydidXR0b24nLCAnbGluaycsICdjaGVja2JveCcsICdyYWRpbycsICd0YWInXS5pbmNsdWRlcyhlbGVtZW50LmdldEF0dHJpYnV0ZSgncm9sZScpKTsKCiAgICBpZiAoIWlzQ2xpY2thYmxlVGFnICYmICFoYXNDbGlja1JvbGUpIHsKICAgICAgd2FybignV2FybmluZzogQ2xpY2tpbmcgbm9uLWludGVyYWN0aXZlIGVsZW1lbnQ6JywgdGFnLCBlbGVtZW50LmNsYXNzTmFtZSk7CiAgICB9CgogICAgLy8gVmlzdWFsIGZlZWRiYWNrCiAgICBzaG93SGlnaGxpZ2h0KGVsZW1lbnQsICdBSSBDbGljaycpOwogICAgY29uc3QgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICBjb25zdCB4ID0gcmVjdC5sZWZ0ICsgcmVjdC53aWR0aCAvIDI7CiAgICBjb25zdCB5ID0gcmVjdC50b3AgKyByZWN0LmhlaWdodCAvIDI7CgogICAgLy8gRGVsYXkgZm9yIHZpc3VhbCBlZmZlY3QKICAgIGF3YWl0IG5ldyBQcm9taXNlKHIgPT4gc2V0VGltZW91dChyLCAzMDApKTsKICAgIHNob3dDbGlja1JpcHBsZSh4LCB5KTsKCiAgICAvLyBTY3JvbGwgaW50byB2aWV3IGlmIG5lZWRlZAogICAgZWxlbWVudC5zY3JvbGxJbnRvVmlldyh7IGJlaGF2aW9yOiAnc21vb3RoJywgYmxvY2s6ICdjZW50ZXInIH0pOwogICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIDIwMCkpOwoKICAgIC8vIENhcHR1cmUgc3RhdGUgYmVmb3JlIGNsaWNrIGZvciB2ZXJpZmljYXRpb24KICAgIGNvbnN0IGJlZm9yZUhUTUwgPSBkb2N1bWVudC5ib2R5LmlubmVySFRNTC5sZW5ndGg7CiAgICBjb25zdCBiZWZvcmVFbGVtZW50Q291bnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcqJykubGVuZ3RoOwoKICAgIC8vIFBlcmZvcm0gY2xpY2sKICAgIGVsZW1lbnQuY2xpY2soKTsKCiAgICAvLyBXYWl0IGJyaWVmbHkgZm9yIFJlYWN0L0RPTSB1cGRhdGVzCiAgICBhd2FpdCBuZXcgUHJvbWlzZShyID0+IHNldFRpbWVvdXQociwgMTUwKSk7CgogICAgLy8gVmVyaWZ5IGNsaWNrIGhhZCBlZmZlY3QgKERPTSBjaGFuZ2VkKQogICAgY29uc3QgYWZ0ZXJIVE1MID0gZG9jdW1lbnQuYm9keS5pbm5lckhUTUwubGVuZ3RoOwogICAgY29uc3QgYWZ0ZXJFbGVtZW50Q291bnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcqJykubGVuZ3RoOwogICAgY29uc3QgZG9tQ2hhbmdlZCA9IGJlZm9yZUhUTUwgIT09IGFmdGVySFRNTCB8fCBiZWZvcmVFbGVtZW50Q291bnQgIT09IGFmdGVyRWxlbWVudENvdW50OwoKICAgIC8vIEJ1aWxkIGRldGFpbGVkIHJlc3BvbnNlCiAgICBjb25zdCByZXNwb25zZSA9IHsKICAgICAgc3VjY2VzczogdHJ1ZSwKICAgICAgZWxlbWVudDogewogICAgICAgIHRhZ05hbWU6IGVsZW1lbnQudGFnTmFtZSwKICAgICAgICB0ZXh0OiBub3JtYWxpemVUZXh0KGVsZW1lbnQudGV4dENvbnRlbnQpPy5zbGljZSgwLCAxMDApLAogICAgICAgIGlkOiBlbGVtZW50LmlkIHx8IHVuZGVmaW5lZCwKICAgICAgICBjbGFzc05hbWU6IGVsZW1lbnQuY2xhc3NOYW1lIHx8IHVuZGVmaW5lZCwKICAgICAgICB1bmlxdWVTZWxlY3RvcjogZ2V0VW5pcXVlU2VsZWN0b3IoZWxlbWVudCksCiAgICAgICAgaXNJbnRlcmFjdGl2ZTogc2VsZWN0ZWRJc0ludGVyYWN0aXZlCiAgICAgIH0sCiAgICAgIHNlYXJjaERldGFpbHM6IHsKICAgICAgICBtYXRjaENvdW50LAogICAgICAgIGludGVyYWN0aXZlTWF0Y2hDb3VudCwKICAgICAgICBpc0FtYmlndW91cywKICAgICAgICBzZWxlY3RlZElzSW50ZXJhY3RpdmUKICAgICAgfSwKICAgICAgdmVyaWZpY2F0aW9uOiB7CiAgICAgICAgZG9tQ2hhbmdlZCwKICAgICAgICBub3RlOiBkb21DaGFuZ2VkID8gJ0RPTSB1cGRhdGVkIGFmdGVyIGNsaWNrJyA6ICdObyB2aXNpYmxlIERPTSBjaGFuZ2UgZGV0ZWN0ZWQnCiAgICAgIH0KICAgIH07CgogICAgLy8gQWRkIHdhcm5pbmdzIGZvciBwb3RlbnRpYWwgaXNzdWVzCiAgICBjb25zdCB3YXJuaW5ncyA9IFtdOwogICAgaWYgKGlzQW1iaWd1b3VzKSB7CiAgICAgIHdhcm5pbmdzLnB1c2goJ011bHRpcGxlIGVsZW1lbnRzIG1hdGNoZWQgIicgKyBzZWxlY3RvciArICciICgnICsgbWF0Y2hDb3VudCArICcgdG90YWwsICcgKyBpbnRlcmFjdGl2ZU1hdGNoQ291bnQgKyAnIGludGVyYWN0aXZlKScpOwogICAgfQogICAgaWYgKCFzZWxlY3RlZElzSW50ZXJhY3RpdmUpIHsKICAgICAgd2FybmluZ3MucHVzaCgnQ2xpY2tlZCBub24taW50ZXJhY3RpdmUgZWxlbWVudCAoJyArIHRhZyArICcpIC0gZXhwZWN0ZWQgYnV0dG9uL2xpbmsvaW5wdXQnKTsKICAgIH0KICAgIGlmICghZG9tQ2hhbmdlZCAmJiBzZWxlY3RlZElzSW50ZXJhY3RpdmUpIHsKICAgICAgd2FybmluZ3MucHVzaCgnQ2xpY2sgbWF5IGhhdmUgZmFpbGVkIC0gbm8gRE9NIGNoYW5nZSBkZXRlY3RlZC4gVHJ5ICJidXR0b246JyArIHNlbGVjdG9yICsgJyIgZm9yIHByZWNpc2lvbicpOwogICAgfQogICAgaWYgKHdhcm5pbmdzLmxlbmd0aCA+IDApIHsKICAgICAgcmVzcG9uc2Uud2FybmluZyA9IHdhcm5pbmdzLmpvaW4oJy4gJyk7CiAgICB9CgogICAgcmV0dXJuIHJlc3BvbnNlOwogIH0KCiAgYXN5bmMgZnVuY3Rpb24gcGVyZm9ybVR5cGUoc2VsZWN0b3IsIHRleHQpIHsKICAgIGNvbnN0IGVsZW1lbnQgPSBmaW5kRWxlbWVudChzZWxlY3Rvcik7CiAgICBpZiAoIWVsZW1lbnQpIHsKICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRWxlbWVudCBub3QgZm91bmQ6ICcgKyBzZWxlY3RvciB9OwogICAgfQoKICAgIC8vIEhhbmRsZSB1bmRlZmluZWQvbnVsbC9lbXB0eSB0ZXh0CiAgICBjb25zdCB0ZXh0VG9UeXBlID0gdGV4dCB8fCAnJzsKCiAgICAvLyBWaXN1YWwgZmVlZGJhY2sKICAgIHNob3dIaWdobGlnaHQoZWxlbWVudCwgJ0FJIFR5cGUnKTsKICAgIGF3YWl0IG5ldyBQcm9taXNlKHIgPT4gc2V0VGltZW91dChyLCAzMDApKTsKICAgIHNob3dUeXBpbmdJbmRpY2F0b3IoZWxlbWVudCwgdGV4dFRvVHlwZSB8fCAnKGNsZWFyaW5nKScpOwoKICAgIC8vIEZvY3VzIGFuZCB0eXBlCiAgICBlbGVtZW50LmZvY3VzKCk7CgogICAgaWYgKGVsZW1lbnQudGFnTmFtZSA9PT0gJ0lOUFVUJyB8fCBlbGVtZW50LnRhZ05hbWUgPT09ICdURVhUQVJFQScpIHsKICAgICAgLy8gRm9yIFJlYWN0IGNvbnRyb2xsZWQgaW5wdXRzLCB3ZSBuZWVkIHRvIHVzZSB0aGUgbmF0aXZlIHZhbHVlIHNldHRlcgogICAgICAvLyBhbmQgZGlzcGF0Y2ggYSBwcm9wZXIgaW5wdXQgZXZlbnQgdGhhdCBSZWFjdCBjYW4gaW50ZXJjZXB0CiAgICAgIGNvbnN0IG5hdGl2ZUlucHV0VmFsdWVTZXR0ZXIgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKAogICAgICAgIGVsZW1lbnQudGFnTmFtZSA9PT0gJ0lOUFVUJyA/IHdpbmRvdy5IVE1MSW5wdXRFbGVtZW50LnByb3RvdHlwZSA6IHdpbmRvdy5IVE1MVGV4dEFyZWFFbGVtZW50LnByb3RvdHlwZSwKICAgICAgICAndmFsdWUnCiAgICAgICk/LnNldDsKCiAgICAgIGlmIChuYXRpdmVJbnB1dFZhbHVlU2V0dGVyKSB7CiAgICAgICAgbmF0aXZlSW5wdXRWYWx1ZVNldHRlci5jYWxsKGVsZW1lbnQsIHRleHRUb1R5cGUpOwogICAgICB9IGVsc2UgewogICAgICAgIGVsZW1lbnQudmFsdWUgPSB0ZXh0VG9UeXBlOwogICAgICB9CgogICAgICAvLyBEaXNwYXRjaCBpbnB1dCBldmVudCB0aGF0IFJlYWN0IGxpc3RlbnMgdG8KICAgICAgY29uc3QgaW5wdXRFdmVudCA9IG5ldyBFdmVudCgnaW5wdXQnLCB7IGJ1YmJsZXM6IHRydWUsIGNhbmNlbGFibGU6IHRydWUgfSk7CiAgICAgIC8vIFJlYWN0IDE2KyB1c2VzIHRoaXMgcHJvcGVydHkKICAgICAgaW5wdXRFdmVudC5zaW11bGF0ZWQgPSB0cnVlOwogICAgICBlbGVtZW50LmRpc3BhdGNoRXZlbnQoaW5wdXRFdmVudCk7CgogICAgICAvLyBBbHNvIGRpc3BhdGNoIGNoYW5nZSBmb3IgZ29vZCBtZWFzdXJlCiAgICAgIGVsZW1lbnQuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2NoYW5nZScsIHsgYnViYmxlczogdHJ1ZSB9KSk7CiAgICB9IGVsc2UgaWYgKGVsZW1lbnQuaXNDb250ZW50RWRpdGFibGUpIHsKICAgICAgZWxlbWVudC50ZXh0Q29udGVudCA9IHRleHRUb1R5cGU7CiAgICAgIGVsZW1lbnQuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2lucHV0JywgeyBidWJibGVzOiB0cnVlIH0pKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICBzdWNjZXNzOiB0cnVlLAogICAgICBlbGVtZW50OiB7CiAgICAgICAgdGFnTmFtZTogZWxlbWVudC50YWdOYW1lLAogICAgICAgIGlkOiBlbGVtZW50LmlkLAogICAgICAgIHZhbHVlOiBlbGVtZW50LnZhbHVlIHx8IHRleHRUb1R5cGUKICAgICAgfQogICAgfTsKICB9CgogIGFzeW5jIGZ1bmN0aW9uIHBlcmZvcm1TZWxlY3Qoc2VsZWN0b3IsIHZhbHVlKSB7CiAgICBjb25zdCBlbGVtZW50ID0gZmluZEVsZW1lbnQoc2VsZWN0b3IpOwogICAgaWYgKCFlbGVtZW50IHx8IGVsZW1lbnQudGFnTmFtZSAhPT0gJ1NFTEVDVCcpIHsKICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnU2VsZWN0IGVsZW1lbnQgbm90IGZvdW5kOiAnICsgc2VsZWN0b3IgfTsKICAgIH0KCiAgICBzaG93SGlnaGxpZ2h0KGVsZW1lbnQsICdBSSBTZWxlY3QnKTsKICAgIGF3YWl0IG5ldyBQcm9taXNlKHIgPT4gc2V0VGltZW91dChyLCAzMDApKTsKCiAgICBlbGVtZW50LnZhbHVlID0gdmFsdWU7CiAgICBlbGVtZW50LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdjaGFuZ2UnLCB7IGJ1YmJsZXM6IHRydWUgfSkpOwoKICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHZhbHVlIH07CiAgfQoKICBhc3luYyBmdW5jdGlvbiBwZXJmb3JtU2Nyb2xsKGRpcmVjdGlvbiwgYW1vdW50ID0gMzAwKSB7CiAgICBjb25zdCBzY3JvbGxBbW91bnQgPSBkaXJlY3Rpb24gPT09ICd1cCcgPyAtYW1vdW50IDogYW1vdW50OwogICAgd2luZG93LnNjcm9sbEJ5KHsgdG9wOiBzY3JvbGxBbW91bnQsIGJlaGF2aW9yOiAnc21vb3RoJyB9KTsKICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHNjcm9sbGVkOiBzY3JvbGxBbW91bnQgfTsKICB9CgogIGZ1bmN0aW9uIGdldFNuYXBzaG90KCkgewogICAgLy8gR2V0IGFjY2Vzc2liaWxpdHktdHJlZS1zdHlsZSBzbmFwc2hvdCAtIG9wdGltaXplZCBmb3IgTExNIHVuZGVyc3RhbmRpbmcKICAgIC8vIEZvcm1hdDogU2ltcGxlIHRleHQtYmFzZWQgdHJlZSB0aGF0IENsYXVkZSBjYW4gZWFzaWx5IHBhcnNlIGFuZCBhY3Qgb24KICAgIC8vIE5PVyBJTkNMVURFUyBTSEFET1cgRE9NIEVMRU1FTlRTIGZvciBXZWIgQ29tcG9uZW50IHN1cHBvcnQKICAgIGNvbnN0IGxpbmVzID0gW107CiAgICBsaW5lcy5wdXNoKCc9PT0gUGFnZSBTbmFwc2hvdCA9PT0nKTsKICAgIGxpbmVzLnB1c2goJ1VSTDogJyArIHdpbmRvdy5sb2NhdGlvbi5ocmVmKTsKICAgIGxpbmVzLnB1c2goJ1RpdGxlOiAnICsgZG9jdW1lbnQudGl0bGUpOwogICAgbGluZXMucHVzaCgnJyk7CiAgICBsaW5lcy5wdXNoKCc9PT0gSW50ZXJhY3RpdmUgRWxlbWVudHMgKGluY2x1ZGluZyBTaGFkb3cgRE9NKSA9PT0nKTsKICAgIGxpbmVzLnB1c2goJyhVc2UgZXhhY3QgdGV4dCBpbiBxdW90ZXMsIG9yICJidXR0b246VGV4dCIgLyAibGluazpUZXh0IiAvICJpbnB1dDpwbGFjZWhvbGRlciIgZm9yIHByZWNpc2lvbiknKTsKICAgIGxpbmVzLnB1c2goJycpOwoKICAgIC8vIFVzZSBkZWVwIHRyYXZlcnNhbCB0byBmaW5kIEFMTCBpbnRlcmFjdGl2ZSBlbGVtZW50cyBpbmNsdWRpbmcgc2hhZG93IERPTQogICAgY29uc3QgYWxsRWxlbWVudHMgPSBnZXRBbGxJbnRlcmFjdGl2ZUVsZW1lbnRzKCk7CiAgICBsZXQgaWR4ID0gMDsKICAgIGNvbnN0IHNlZW5UZXh0cyA9IG5ldyBNYXAoKTsgIC8vIFRyYWNrIGR1cGxpY2F0ZSB0ZXh0IGZvciB3YXJuaW5nCiAgICBsZXQgc2hhZG93RE9NQ291bnQgPSAwOwoKICAgIGZvciAoY29uc3QgZWwgb2YgYWxsRWxlbWVudHMpIHsKICAgICAgY29uc3QgcmVjdCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAvLyBTa2lwIGludmlzaWJsZSBlbGVtZW50cwogICAgICBpZiAocmVjdC53aWR0aCA9PT0gMCB8fCByZWN0LmhlaWdodCA9PT0gMCkgY29udGludWU7CiAgICAgIGNvbnN0IHN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWwpOwogICAgICBpZiAoc3R5bGUuZGlzcGxheSA9PT0gJ25vbmUnIHx8IHN0eWxlLnZpc2liaWxpdHkgPT09ICdoaWRkZW4nKSBjb250aW51ZTsKCiAgICAgIGNvbnN0IGluVmlld3BvcnQgPSByZWN0LnRvcCA8IHdpbmRvdy5pbm5lckhlaWdodCAmJiByZWN0LmJvdHRvbSA+IDA7CgogICAgICAvLyBDaGVjayBpZiBlbGVtZW50IGlzIGluIHNoYWRvdyBET00KICAgICAgY29uc3QgaW5TaGFkb3cgPSBlbC5nZXRSb290Tm9kZSgpICE9PSBkb2N1bWVudDsKICAgICAgaWYgKGluU2hhZG93KSBzaGFkb3dET01Db3VudCsrOwoKICAgICAgY29uc3QgdGFnID0gZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICBjb25zdCByb2xlID0gZWwuZ2V0QXR0cmlidXRlKCdyb2xlJykgfHwgdGFnOwogICAgICAvLyBVc2UgZ2V0VmlzaWJsZVRleHQgZm9yIHByb3BlciBzaGFkb3cgRE9NIHNsb3QgaGFuZGxpbmcKICAgICAgY29uc3QgcmF3VGV4dCA9IGdldFZpc2libGVUZXh0KGVsKTsKICAgICAgY29uc3QgdGV4dCA9IHJhd1RleHQuc2xpY2UoMCwgNjApOwogICAgICBjb25zdCBub3JtYWxpemVkVGV4dCA9IG5vcm1hbGl6ZVRleHQocmF3VGV4dCk7CiAgICAgIGNvbnN0IGxhYmVsID0gZWwuZ2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJykgfHwgZWwucGxhY2Vob2xkZXIgfHwgZWwudGl0bGUgfHwgJyc7CiAgICAgIGNvbnN0IHZhbHVlID0gZWwudmFsdWUgfHwgJyc7CiAgICAgIGNvbnN0IGRpc2FibGVkID0gZWwuZGlzYWJsZWQgPyAnIFtkaXNhYmxlZF0nIDogJyc7CiAgICAgIGNvbnN0IHZpZXdwb3J0ID0gaW5WaWV3cG9ydCA/ICcnIDogJyBbb2Zmc2NyZWVuXSc7CiAgICAgIGNvbnN0IHNoYWRvd01hcmtlciA9IGluU2hhZG93ID8gJyBbc2hhZG93XScgOiAnJzsKCiAgICAgIC8vIFRyYWNrIHRleHQgZm9yIGR1cGxpY2F0ZSBkZXRlY3Rpb24KICAgICAgaWYgKG5vcm1hbGl6ZWRUZXh0KSB7CiAgICAgICAgc2VlblRleHRzLnNldChub3JtYWxpemVkVGV4dCwgKHNlZW5UZXh0cy5nZXQobm9ybWFsaXplZFRleHQpIHx8IDApICsgMSk7CiAgICAgIH0KCiAgICAgIC8vIEJ1aWxkIHJlYWRhYmxlIGRlc2NyaXB0aW9uIHdpdGggdGFyZ2V0aW5nIGhpbnRzCiAgICAgIGxldCBkZXNjID0gJyc7CiAgICAgIGxldCB0YXJnZXRIaW50ID0gJyc7ICAvLyBVbmlxdWUgc2VsZWN0b3IgaGludAoKICAgICAgaWYgKHRhZyA9PT0gJ2J1dHRvbicgfHwgcm9sZSA9PT0gJ2J1dHRvbicpIHsKICAgICAgICBkZXNjID0gJ0J1dHRvbjogIicgKyAodGV4dCB8fCBsYWJlbCB8fCAndW5uYW1lZCcpICsgJyInICsgZGlzYWJsZWQgKyB2aWV3cG9ydCArIHNoYWRvd01hcmtlcjsKICAgICAgICB0YXJnZXRIaW50ID0gdGV4dCA/ICdidXR0b246JyArIHRleHQgOiAobGFiZWwgPyAnYnV0dG9uOicgKyBsYWJlbCA6ICcnKTsKICAgICAgfSBlbHNlIGlmICh0YWcgPT09ICdhJykgewogICAgICAgIGRlc2MgPSAnTGluazogIicgKyAodGV4dCB8fCBsYWJlbCB8fCBlbC5ocmVmIHx8ICd1bm5hbWVkJykgKyAnIicgKyB2aWV3cG9ydCArIHNoYWRvd01hcmtlcjsKICAgICAgICB0YXJnZXRIaW50ID0gdGV4dCA/ICdsaW5rOicgKyB0ZXh0IDogJyc7CiAgICAgIH0gZWxzZSBpZiAodGFnID09PSAnaW5wdXQnKSB7CiAgICAgICAgY29uc3QgaW5wdXRUeXBlID0gZWwudHlwZSB8fCAndGV4dCc7CiAgICAgICAgaWYgKGlucHV0VHlwZSA9PT0gJ2NoZWNrYm94JyB8fCBpbnB1dFR5cGUgPT09ICdyYWRpbycpIHsKICAgICAgICAgIGRlc2MgPSAoaW5wdXRUeXBlID09PSAnY2hlY2tib3gnID8gJ0NoZWNrYm94JyA6ICdSYWRpbycpICsgJzogIicgKyAobGFiZWwgfHwgdGV4dCB8fCBlbC5uYW1lIHx8ICd1bm5hbWVkJykgKyAnIiBbJyArIChlbC5jaGVja2VkID8gJ2NoZWNrZWQnIDogJ3VuY2hlY2tlZCcpICsgJ10nICsgZGlzYWJsZWQgKyBzaGFkb3dNYXJrZXI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlc2MgPSAnSW5wdXQgKCcgKyBpbnB1dFR5cGUgKyAnKTogIicgKyAobGFiZWwgfHwgZWwucGxhY2Vob2xkZXIgfHwgZWwubmFtZSB8fCAndW5uYW1lZCcpICsgJyInICsgKHZhbHVlID8gJyA9ICInICsgdmFsdWUuc2xpY2UoMCwgMzApICsgJyInIDogJycpICsgZGlzYWJsZWQgKyBzaGFkb3dNYXJrZXI7CiAgICAgICAgICB0YXJnZXRIaW50ID0gKGxhYmVsIHx8IGVsLnBsYWNlaG9sZGVyKSA/ICdpbnB1dDonICsgKGxhYmVsIHx8IGVsLnBsYWNlaG9sZGVyKSA6ICcnOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0YWcgPT09ICd0ZXh0YXJlYScpIHsKICAgICAgICBkZXNjID0gJ1RleHRhcmVhOiAiJyArIChsYWJlbCB8fCBlbC5wbGFjZWhvbGRlciB8fCBlbC5uYW1lIHx8ICd1bm5hbWVkJykgKyAnIicgKyAodmFsdWUgPyAnID0gIicgKyB2YWx1ZS5zbGljZSgwLCAzMCkgKyAnLi4uIicgOiAnJykgKyBkaXNhYmxlZCArIHNoYWRvd01hcmtlcjsKICAgICAgfSBlbHNlIGlmICh0YWcgPT09ICdzZWxlY3QnKSB7CiAgICAgICAgY29uc3Qgc2VsZWN0ZWRPcHRpb24gPSBlbC5vcHRpb25zPy5bZWwuc2VsZWN0ZWRJbmRleF07CiAgICAgICAgZGVzYyA9ICdEcm9wZG93bjogIicgKyAobGFiZWwgfHwgZWwubmFtZSB8fCAndW5uYW1lZCcpICsgJyInICsgKHNlbGVjdGVkT3B0aW9uID8gJyA9ICInICsgc2VsZWN0ZWRPcHRpb24udGV4dCArICciJyA6ICcnKSArIGRpc2FibGVkICsgc2hhZG93TWFya2VyOwogICAgICB9IGVsc2UgaWYgKHRhZy5tYXRjaCgvXmhbMS02XSQvKSkgewogICAgICAgIGRlc2MgPSAnSGVhZGluZyAoJyArIHRhZyArICcpOiAiJyArIHRleHQgKyAnIic7CiAgICAgIH0gZWxzZSBpZiAodGFnID09PSAnZm9ybScpIHsKICAgICAgICBkZXNjID0gJ0Zvcm06ICInICsgKGVsLm5hbWUgfHwgZWwuaWQgfHwgJ3VubmFtZWQnKSArICciJzsKICAgICAgfSBlbHNlIGlmICh0YWcuaW5jbHVkZXMoJy0nKSkgewogICAgICAgIC8vIEN1c3RvbSBlbGVtZW50IC8gd2ViIGNvbXBvbmVudAogICAgICAgIGRlc2MgPSAnQ29tcG9uZW50ICgnICsgdGFnICsgJyk6ICInICsgKHRleHQgfHwgbGFiZWwgfHwgJ3VubmFtZWQnKSArICciJyArIHZpZXdwb3J0ICsgc2hhZG93TWFya2VyOwogICAgICAgIHRhcmdldEhpbnQgPSB0ZXh0ID8gJ2J1dHRvbjonICsgdGV4dCA6ICcnOyAgLy8gTW9zdCBjdXN0b20gZWxlbWVudHMgYWN0IGxpa2UgYnV0dG9ucwogICAgICB9IGVsc2UgewogICAgICAgIGRlc2MgPSByb2xlICsgJzogIicgKyAodGV4dCB8fCBsYWJlbCB8fCAndW5uYW1lZCcpICsgJyInICsgdmlld3BvcnQgKyBzaGFkb3dNYXJrZXI7CiAgICAgIH0KCiAgICAgIC8vIEFkZCBJRCBoaW50IGlmIGF2YWlsYWJsZSAobW9zdCByZWxpYWJsZSBzZWxlY3RvcikKICAgICAgaWYgKGVsLmlkKSB7CiAgICAgICAgdGFyZ2V0SGludCA9ICcjJyArIGVsLmlkOwogICAgICB9CgogICAgICBsaW5lcy5wdXNoKCdbJyArIGlkeCArICddICcgKyBkZXNjICsgKHRhcmdldEhpbnQgPyAnICDihpIgICcgKyB0YXJnZXRIaW50IDogJycpKTsKICAgICAgaWR4Kys7CiAgICB9CgogICAgaWYgKGlkeCA9PT0gMCkgewogICAgICBsaW5lcy5wdXNoKCcoTm8gaW50ZXJhY3RpdmUgZWxlbWVudHMgZm91bmQpJyk7CiAgICB9CgogICAgLy8gU2hvdyBzaGFkb3cgRE9NIHN0YXRzIGlmIGFueSBmb3VuZAogICAgaWYgKHNoYWRvd0RPTUNvdW50ID4gMCkgewogICAgICBsaW5lcy5wdXNoKCcnKTsKICAgICAgbGluZXMucHVzaCgnPT09IFNoYWRvdyBET00gPT09Jyk7CiAgICAgIGxpbmVzLnB1c2goc2hhZG93RE9NQ291bnQgKyAnIGVsZW1lbnRzIGZvdW5kIGluc2lkZSBzaGFkb3cgRE9NIChtYXJrZWQgd2l0aCBbc2hhZG93XSknKTsKICAgICAgbGluZXMucHVzaCgnVGhlc2UgZWxlbWVudHMgYXJlIGZ1bGx5IHN1cHBvcnRlZCAtIHVzZSB0aGUgc2FtZSBzZWxlY3RvcnMnKTsKICAgIH0KCiAgICAvLyBXYXJuIGFib3V0IGR1cGxpY2F0ZSB0ZXh0IChhbWJpZ3VpdHkgcmlzaykKICAgIGNvbnN0IGR1cGxpY2F0ZXMgPSBBcnJheS5mcm9tKHNlZW5UZXh0cy5lbnRyaWVzKCkpLmZpbHRlcigoWywgY291bnRdKSA9PiBjb3VudCA+IDEpOwogICAgaWYgKGR1cGxpY2F0ZXMubGVuZ3RoID4gMCkgewogICAgICBsaW5lcy5wdXNoKCcnKTsKICAgICAgbGluZXMucHVzaCgnPT09IEFNQklHVUlUWSBXQVJOSU5HID09PScpOwogICAgICBsaW5lcy5wdXNoKCdUaGVzZSB0ZXh0cyBhcHBlYXIgb24gbXVsdGlwbGUgZWxlbWVudHMgLSB1c2UgcHJlY2lzZSBzZWxlY3RvcnM6Jyk7CiAgICAgIGR1cGxpY2F0ZXMuZm9yRWFjaCgoW3RleHQsIGNvdW50XSkgPT4gewogICAgICAgIGxpbmVzLnB1c2goJyAgIicgKyB0ZXh0ICsgJyIgYXBwZWFycyAnICsgY291bnQgKyAneCAtIHVzZSAiYnV0dG9uOicgKyB0ZXh0ICsgJyIgb3IgImxpbms6JyArIHRleHQgKyAnIicpOwogICAgICB9KTsKICAgIH0KCiAgICBsaW5lcy5wdXNoKCcnKTsKICAgIGxpbmVzLnB1c2goJz09PSBVc2FnZSA9PT0nKTsKICAgIGxpbmVzLnB1c2goJ0NsaWNrOiB2aWJlLWJyb3dzZXIgY2xpY2sgIkJ1dHRvbiB0ZXh0IicpOwogICAgbGluZXMucHVzaCgnQ2xpY2sgKHByZWNpc2UpOiB2aWJlLWJyb3dzZXIgY2xpY2sgImJ1dHRvbjpBZGQiIG9yICJsaW5rOkhvbWUiIG9yICJpbnB1dDpTZWFyY2giJyk7CiAgICBsaW5lcy5wdXNoKCdUeXBlOiB2aWJlLWJyb3dzZXIgdHlwZSAicGxhY2Vob2xkZXIgdGV4dCIgInRleHQgdG8gdHlwZSInKTsKICAgIGxpbmVzLnB1c2goJ1Njcm9sbDogdmliZS1icm93c2VyIHNjcm9sbCBkb3duJyk7CiAgICBsaW5lcy5wdXNoKCcnKTsKICAgIGxpbmVzLnB1c2goJ1RoZSBzeXN0ZW0gYXV0by1yZXRyaWVzIGZvciAycyBhbmQgdmVyaWZpZXMgY2xpY2tzIGFjdHVhbGx5IHdvcmtlZC4nKTsKCiAgICByZXR1cm4gewogICAgICB1cmw6IHdpbmRvdy5sb2NhdGlvbi5ocmVmLAogICAgICB0aXRsZTogZG9jdW1lbnQudGl0bGUsCiAgICAgIHZpZXdwb3J0OiB7IHdpZHRoOiB3aW5kb3cuaW5uZXJXaWR0aCwgaGVpZ2h0OiB3aW5kb3cuaW5uZXJIZWlnaHQgfSwKICAgICAgc2Nyb2xsWTogd2luZG93LnNjcm9sbFksCiAgICAgIGVsZW1lbnRDb3VudDogaWR4LAogICAgICBzaGFkb3dET01Db3VudDogc2hhZG93RE9NQ291bnQsCiAgICAgIC8vIFJldHVybiBib3RoIHN0cnVjdHVyZWQgYW5kIHRleHQgZm9ybWF0CiAgICAgIHNuYXBzaG90OiBsaW5lcy5qb2luKCdcbicpCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gZ2V0UGFnZUNvbnRlbnQoKSB7CiAgICByZXR1cm4gewogICAgICB1cmw6IHdpbmRvdy5sb2NhdGlvbi5ocmVmLAogICAgICB0aXRsZTogZG9jdW1lbnQudGl0bGUsCiAgICAgIHRleHQ6IGRvY3VtZW50LmJvZHkuaW5uZXJUZXh0LnNsaWNlKDAsIDUwMDApLAogICAgICBodG1sOiBkb2N1bWVudC5ib2R5LmlubmVySFRNTC5zbGljZSgwLCAxMDAwMCkKICAgIH07CiAgfQoKICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICAvLyBTQ1JFRU5TSE9UIENBUFRVUkUgLSBTbmFwRE9NIChmYXN0LCBtb2Rlcm4gQ1NTIHN1cHBvcnQpCiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCgogIGxldCBzbmFwZG9tTGliID0gbnVsbDsKCiAgYXN5bmMgZnVuY3Rpb24gbG9hZFNuYXBkb20oKSB7CiAgICBpZiAoc25hcGRvbUxpYikgcmV0dXJuIHNuYXBkb21MaWI7CiAgICBpZiAod2luZG93LnNuYXBkb20pIHsKICAgICAgc25hcGRvbUxpYiA9IHdpbmRvdy5zbmFwZG9tOwogICAgICByZXR1cm4gc25hcGRvbUxpYjsKICAgIH0KCiAgICAvLyBUcnkgbm9kZV9tb2R1bGVzIGZpcnN0LCB0aGVuIENETgogICAgdHJ5IHsKICAgICAgY29uc3QgbW9kdWxlID0gYXdhaXQgaW1wb3J0KCdAenVtZXIvc25hcGRvbScpOwogICAgICBzbmFwZG9tTGliID0gbW9kdWxlLnNuYXBkb20gfHwgbW9kdWxlLmRlZmF1bHQgfHwgbW9kdWxlOwogICAgICByZXR1cm4gc25hcGRvbUxpYjsKICAgIH0gY2F0Y2ggewogICAgICAvLyBDRE4gZmFsbGJhY2sKICAgICAgc25hcGRvbUxpYiA9IGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICBjb25zdCBleGlzdGluZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3NjcmlwdFtzcmMqPSJzbmFwZG9tIl0nKTsKICAgICAgICBpZiAoZXhpc3RpbmcpIHsKICAgICAgICAgIGV4aXN0aW5nLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiByZXNvbHZlKHdpbmRvdy5zbmFwZG9tKSk7CiAgICAgICAgICBleGlzdGluZy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsICgpID0+IHJlamVjdChuZXcgRXJyb3IoJ1NjcmlwdCBmYWlsZWQnKSkpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICAgICAgc2NyaXB0LnNyYyA9ICdodHRwczovL3VucGtnLmNvbS9AenVtZXIvc25hcGRvbS9kaXN0L3NuYXBkb20uanMnOwogICAgICAgIHNjcmlwdC5jcm9zc09yaWdpbiA9ICdhbm9ueW1vdXMnOwogICAgICAgIHNjcmlwdC5vbmxvYWQgPSAoKSA9PiByZXNvbHZlKHdpbmRvdy5zbmFwZG9tKTsKICAgICAgICBzY3JpcHQub25lcnJvciA9ICgpID0+IHJlamVjdChuZXcgRXJyb3IoJ0NETiBmYWlsZWQnKSk7CiAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOwogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gcmVqZWN0KG5ldyBFcnJvcignVGltZW91dCcpKSwgMTAwMDApOwogICAgICB9KTsKICAgICAgcmV0dXJuIHNuYXBkb21MaWI7CiAgICB9CiAgfQoKICAvLyBQcmVsb2FkIG9uIGluaXQKICBsb2FkU25hcGRvbSgpLmNhdGNoKCgpID0+IHt9KTsKCiAgLy8gRmFsbGJhY2s6IFNpbXBsZSBET00gc25hcHNob3Qgd2hlbiBTbmFwRE9NIHVuYXZhaWxhYmxlCiAgZnVuY3Rpb24gY3JlYXRlRmFsbGJhY2tTbmFwc2hvdCh3aWR0aCwgaGVpZ2h0KSB7CiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoOwogICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDsKICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgaWYgKCFjdHgpIHJldHVybiBudWxsOwoKICAgIGNvbnN0IGJvZHlTdHlsZSA9IGdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuYm9keSk7CiAgICBsZXQgYmdDb2xvciA9IGJvZHlTdHlsZS5iYWNrZ3JvdW5kQ29sb3IgfHwgJyNmZmZmZmYnOwogICAgaWYgKGJnQ29sb3IgPT09ICdyZ2JhKDAsIDAsIDAsIDApJykgYmdDb2xvciA9ICcjZmZmZmZmJzsKCiAgICBjdHguZmlsbFN0eWxlID0gYmdDb2xvcjsKICAgIGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICBjb25zdCBzY2FsZSA9IHdpZHRoIC8gTWF0aC5tYXgod2luZG93LmlubmVyV2lkdGgsIDEpOwogICAgY29uc3Qgcm9vdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyb290JykgfHwgZG9jdW1lbnQuYm9keTsKICAgIGNvbnN0IGVsZW1lbnRzID0gcm9vdC5xdWVyeVNlbGVjdG9yQWxsKCcqJyk7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNYXRoLm1pbihlbGVtZW50cy5sZW5ndGgsIDgwKTsgaSsrKSB7CiAgICAgIGNvbnN0IGVsID0gZWxlbWVudHNbaV07CiAgICAgIGlmIChlbC50YWdOYW1lID09PSAnU0NSSVBUJyB8fCBlbC50YWdOYW1lID09PSAnU1RZTEUnKSBjb250aW51ZTsKCiAgICAgIGNvbnN0IHJlY3QgPSBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgaWYgKHJlY3Qud2lkdGggPCA1IHx8IHJlY3QuaGVpZ2h0IDwgNSkgY29udGludWU7CiAgICAgIGlmIChyZWN0LnRvcCA+IHdpbmRvdy5pbm5lckhlaWdodCB8fCByZWN0LmJvdHRvbSA8IDApIGNvbnRpbnVlOwoKICAgICAgY29uc3Qgc3R5bGUgPSBnZXRDb21wdXRlZFN0eWxlKGVsKTsKICAgICAgY29uc3QgYmcgPSBzdHlsZS5iYWNrZ3JvdW5kQ29sb3I7CgogICAgICBpZiAoYmcgJiYgYmcgIT09ICdyZ2JhKDAsIDAsIDAsIDApJyAmJiBiZyAhPT0gYmdDb2xvcikgewogICAgICAgIGN0eC5maWxsU3R5bGUgPSBiZzsKICAgICAgICBjdHguZmlsbFJlY3QocmVjdC5sZWZ0ICogc2NhbGUsIHJlY3QudG9wICogc2NhbGUsIHJlY3Qud2lkdGggKiBzY2FsZSwgcmVjdC5oZWlnaHQgKiBzY2FsZSk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvanBlZycsIDAuOCk7CiAgfQoKICBhc3luYyBmdW5jdGlvbiBjYXB0dXJlU2NyZWVuc2hvdChvcHRpb25zID0ge30pIHsKICAgIGNvbnN0IHsgd2lkdGggPSA0MDAsIGhlaWdodCA9IDMwMCwgcXVhbGl0eSA9IDAuODUgfSA9IG9wdGlvbnM7CgogICAgdHJ5IHsKICAgICAgaWYgKCFzbmFwZG9tTGliKSBhd2FpdCBsb2FkU25hcGRvbSgpOwoKICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc25hcGRvbUxpYihkb2N1bWVudC5ib2R5LCB7CiAgICAgICAgc2NhbGU6IDEsCiAgICAgICAgd2lkdGg6IE1hdGgubWluKHdpbmRvdy5pbm5lcldpZHRoLCAxNDAwKSwKICAgICAgICBoZWlnaHQ6IE1hdGgubWluKHdpbmRvdy5pbm5lckhlaWdodCwgOTAwKSwKICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjZmZmZmZmJywKICAgICAgICBleGNsdWRlOiBbJy52aWJlLWFpLWhpZ2hsaWdodCcsICcudmliZS1haS1jbGljay1yaXBwbGUnLCAnLnZpYmUtZG9tLXRhZ2dlci1vdmVybGF5JywgJyN2aWJlLWRvbS10YWdnZXItc3R5bGVzJ10sCiAgICAgICAgZmFsbGJhY2tVUkw6ICdkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhBUUFCQUlBQUFBQUFBUC8vL3lINUJBRUFBQUFBTEFBQUFBQUJBQUVBQUFJQlJBQTcnCiAgICAgIH0pOwoKICAgICAgY29uc3QgY2FudmFzID0gYXdhaXQgcmVzdWx0LnRvQ2FudmFzKCk7CiAgICAgIGNvbnN0IHRodW1iQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgIHRodW1iQ2FudmFzLndpZHRoID0gd2lkdGg7CiAgICAgIHRodW1iQ2FudmFzLmhlaWdodCA9IGhlaWdodDsKICAgICAgY29uc3QgY3R4ID0gdGh1bWJDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgaWYgKCFjdHgpIHRocm93IG5ldyBFcnJvcignQ2FudmFzIGNvbnRleHQgdW5hdmFpbGFibGUnKTsKCiAgICAgIC8vIENyb3AgYW5kIHNjYWxlIChmYXZvciB0b3Agb2YgcGFnZSkKICAgICAgY29uc3Qgc3JjUmF0aW8gPSBjYW52YXMud2lkdGggLyBjYW52YXMuaGVpZ2h0OwogICAgICBjb25zdCBkZXN0UmF0aW8gPSB3aWR0aCAvIGhlaWdodDsKICAgICAgbGV0IHN4ID0gMCwgc3kgPSAwLCBzdyA9IGNhbnZhcy53aWR0aCwgc2ggPSBjYW52YXMuaGVpZ2h0OwoKICAgICAgaWYgKHNyY1JhdGlvID4gZGVzdFJhdGlvKSB7CiAgICAgICAgc3cgPSBjYW52YXMuaGVpZ2h0ICogZGVzdFJhdGlvOwogICAgICAgIHN4ID0gKGNhbnZhcy53aWR0aCAtIHN3KSAvIDI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2ggPSBjYW52YXMud2lkdGggLyBkZXN0UmF0aW87CiAgICAgIH0KCiAgICAgIGN0eC5kcmF3SW1hZ2UoY2FudmFzLCBzeCwgc3ksIHN3LCBzaCwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CgogICAgICByZXR1cm4gewogICAgICAgIHN1Y2Nlc3M6IHRydWUsCiAgICAgICAgZGF0YTogewogICAgICAgICAgZGF0YVVybDogdGh1bWJDYW52YXMudG9EYXRhVVJMKCdpbWFnZS9qcGVnJywgcXVhbGl0eSksCiAgICAgICAgICB3aWR0aCwKICAgICAgICAgIGhlaWdodCwKICAgICAgICAgIG9yaWdpbmFsV2lkdGg6IGNhbnZhcy53aWR0aCwKICAgICAgICAgIG9yaWdpbmFsSGVpZ2h0OiBjYW52YXMuaGVpZ2h0LAogICAgICAgICAgbWV0aG9kOiAnc25hcGRvbScKICAgICAgICB9CiAgICAgIH07CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIC8vIEZhbGxiYWNrIHRvIERPTSBzbmFwc2hvdAogICAgICB0cnkgewogICAgICAgIGNvbnN0IGRhdGFVcmwgPSBjcmVhdGVGYWxsYmFja1NuYXBzaG90KHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGlmIChkYXRhVXJsKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzdWNjZXNzOiB0cnVlLAogICAgICAgICAgICBkYXRhOiB7IGRhdGFVcmwsIHdpZHRoLCBoZWlnaHQsIG9yaWdpbmFsV2lkdGg6IHdpbmRvdy5pbm5lcldpZHRoLCBvcmlnaW5hbEhlaWdodDogd2luZG93LmlubmVySGVpZ2h0LCBtZXRob2Q6ICdmYWxsYmFjaycgfQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2gge30KCiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZS5tZXNzYWdlIHx8ICdTY3JlZW5zaG90IGNhcHR1cmUgZmFpbGVkJyB9OwogICAgfQogIH0KCiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgLy8gTUVTU0FHRSBIQU5ETEVSCiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCgogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgYXN5bmMgKGV2ZW50KSA9PiB7CiAgICAvLyBPbmx5IGFjY2VwdCBtZXNzYWdlcyBmcm9tIHBhcmVudAogICAgaWYgKGV2ZW50LnNvdXJjZSAhPT0gd2luZG93LnBhcmVudCkgcmV0dXJuOwoKICAgIGNvbnN0IHsgdHlwZSwgaWQsIGFjdGlvbiwgc2VsZWN0b3IsIHRleHQsIHZhbHVlLCBkaXJlY3Rpb24sIGFtb3VudCB9ID0gZXZlbnQuZGF0YTsKICAgIGlmICh0eXBlICE9PSAndmliZS1icm93c2VyLWFjdGlvbicpIHJldHVybjsKCiAgICBsZXQgcmVzdWx0OwogICAgdHJ5IHsKICAgICAgc3dpdGNoIChhY3Rpb24pIHsKICAgICAgICBjYXNlICdjbGljayc6CiAgICAgICAgICByZXN1bHQgPSBhd2FpdCBwZXJmb3JtQ2xpY2soc2VsZWN0b3IpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAndHlwZSc6CiAgICAgICAgICByZXN1bHQgPSBhd2FpdCBwZXJmb3JtVHlwZShzZWxlY3RvciwgdGV4dCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdzZWxlY3QnOgogICAgICAgICAgcmVzdWx0ID0gYXdhaXQgcGVyZm9ybVNlbGVjdChzZWxlY3RvciwgdmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnc2Nyb2xsJzoKICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IHBlcmZvcm1TY3JvbGwoZGlyZWN0aW9uLCBhbW91bnQpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnc25hcHNob3QnOgogICAgICAgICAgcmVzdWx0ID0geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBnZXRTbmFwc2hvdCgpIH07CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdjb250ZW50JzoKICAgICAgICAgIHJlc3VsdCA9IHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogZ2V0UGFnZUNvbnRlbnQoKSB9OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnd2FpdCc6CiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyID0+IHNldFRpbWVvdXQociwgYW1vdW50IHx8IDEwMDApKTsKICAgICAgICAgIHJlc3VsdCA9IHsgc3VjY2VzczogdHJ1ZSB9OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnc2NyZWVuc2hvdCc6CiAgICAgICAgICByZXN1bHQgPSBhd2FpdCBjYXB0dXJlU2NyZWVuc2hvdChldmVudC5kYXRhLm9wdGlvbnMgfHwge30pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJlc3VsdCA9IHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnVW5rbm93biBhY3Rpb246ICcgKyBhY3Rpb24gfTsKICAgICAgfQogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgcmVzdWx0ID0geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTsKICAgIH0KCiAgICAvLyBTZW5kIHJlc3VsdCBiYWNrIHRvIHBhcmVudAogICAgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSh7CiAgICAgIHR5cGU6ICd2aWJlLWJyb3dzZXItcmVzdWx0JywKICAgICAgaWQsCiAgICAgIHJlc3VsdAogICAgfSwgJyonKTsKICB9KTsKCiAgLy8gTm90aWZ5IHBhcmVudCB0aGF0IGF1dG9tYXRpb24gaXMgcmVhZHkKICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHsgdHlwZTogJ3ZpYmUtYnJvd3Nlci1yZWFkeScgfSwgJyonKTsKICBsb2coJ0Jyb3dzZXIgYXV0b21hdGlvbiByZWFkeScpOwoKICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICAvLyBIRUFSVEJFQVQgLSBDb250aW51b3VzIG1vbml0b3Jpbmcgc2lnbmFsCiAgLy8gQWxsb3dzIHBhcmVudCB0byBkZXRlY3QgaWYgc2NyaXB0cyBhcmUgbWlzc2luZyBhbmQgdHJpZ2dlciByZS1pbmplY3Rpb24KICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICBjb25zdCBIRUFSVEJFQVRfSU5URVJWQUwgPSAxMDAwMDsgLy8gMTAgc2Vjb25kcwogIGZ1bmN0aW9uIHNlbmRIZWFydGJlYXQoKSB7CiAgICB0cnkgewogICAgICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHsKICAgICAgICB0eXBlOiAndmliZS1oZWFydGJlYXQnLAogICAgICAgIHZlcnNpb246IFNDUklQVF9WRVJTSU9OLAogICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSwKICAgICAgICBjYXBhYmlsaXRpZXM6IHsKICAgICAgICAgIGF1dG9tYXRpb246ICEhd2luZG93Ll9fdmliZUF1dG9tYXRpb24sCiAgICAgICAgICBjb25zb2xlOiAhIXdpbmRvdy5fX3ZpYmVDb25zb2xlQ2FwdHVyZSwKICAgICAgICAgIGRvbTogISF3aW5kb3cuX192aWJlRG9tVGFnZ2VyLAogICAgICAgICAgcm91dGVzOiAhIXdpbmRvdy5fX3ZpYmVSb3V0ZURldGVjdG9ySW5pdGlhbGl6ZWQKICAgICAgICB9CiAgICAgIH0sICcqJyk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIC8vIFNpbGVudCBmYWlsdXJlCiAgICB9CiAgfQoKICAvLyBTZW5kIGluaXRpYWwgaGVhcnRiZWF0CiAgc2VuZEhlYXJ0YmVhdCgpOwoKICAvLyBTZW5kIHBlcmlvZGljIGhlYXJ0YmVhdHMKICBzZXRJbnRlcnZhbChzZW5kSGVhcnRiZWF0LCBIRUFSVEJFQVRfSU5URVJWQUwpOwp9KSgpOwoKCihmdW5jdGlvbigpIHsKICAvLyBBdm9pZCBkb3VibGUtaW5pdGlhbGl6YXRpb24KICBpZiAod2luZG93Ll9fdmliZVJvdXRlRGV0ZWN0b3JJbml0aWFsaXplZCkgcmV0dXJuOwogIHdpbmRvdy5fX3ZpYmVSb3V0ZURldGVjdG9ySW5pdGlhbGl6ZWQgPSB0cnVlOwoKICAvLyBTdG9yZSBkZXRlY3RlZCByb3V0ZXMKICBsZXQgZGV0ZWN0ZWRSb3V0ZXMgPSBuZXcgU2V0KFsnLyddKTsKICBsZXQgY3VycmVudFJvdXRlID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lIHx8ICcvJzsKCiAgLy8gU2VuZCBtZXNzYWdlIHRvIHBhcmVudAogIGZ1bmN0aW9uIHNlbmRUb1BhcmVudCh0eXBlLCBkYXRhKSB7CiAgICB0cnkgewogICAgICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHsKICAgICAgICBzb3VyY2U6ICd2aWJlLXJvdXRlLWRldGVjdG9yJywKICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgIC4uLmRhdGEKICAgICAgfSwgJyonKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgLy8gU2lsZW50IGZhaWx1cmUKICAgIH0KICB9CgogIC8vIFJlcG9ydCBjdXJyZW50IHN0YXRlCiAgZnVuY3Rpb24gcmVwb3J0U3RhdGUoKSB7CiAgICBzZW5kVG9QYXJlbnQoJ3N0YXRlJywgewogICAgICByb3V0ZXM6IEFycmF5LmZyb20oZGV0ZWN0ZWRSb3V0ZXMpLnNvcnQoKSwKICAgICAgY3VycmVudFJvdXRlOiBjdXJyZW50Um91dGUKICAgIH0pOwogIH0KCiAgLy8gRGV0ZWN0IHJvdXRlcyBmcm9tIFJlYWN0IFJvdXRlciBET00KICBmdW5jdGlvbiBkZXRlY3RSZWFjdFJvdXRlclJvdXRlcygpIHsKICAgIC8vIE1ldGhvZCAxOiBMb29rIGZvciBkYXRhLXJvdXRlIGF0dHJpYnV0ZXMgKGlmIGFwcCBhZGRzIHRoZW0pCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1yb3V0ZV0nKS5mb3JFYWNoKGVsID0+IHsKICAgICAgY29uc3Qgcm91dGUgPSBlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcm91dGUnKTsKICAgICAgaWYgKHJvdXRlKSBkZXRlY3RlZFJvdXRlcy5hZGQocm91dGUpOwogICAgfSk7CgogICAgLy8gTWV0aG9kIDI6IExvb2sgZm9yIGFuY2hvciB0YWdzIHdpdGggaHJlZiBzdGFydGluZyB3aXRoIC8KICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2FbaHJlZl49Ii8iXScpLmZvckVhY2goZWwgPT4gewogICAgICBjb25zdCBocmVmID0gZWwuZ2V0QXR0cmlidXRlKCdocmVmJyk7CiAgICAgIGlmIChocmVmICYmICFocmVmLnN0YXJ0c1dpdGgoJy8vJykgJiYgIWhyZWYuaW5jbHVkZXMoJzonKSkgewogICAgICAgIC8vIENsZWFuIHVwIGR5bmFtaWMgc2VnbWVudHMgZm9yIGRpc3BsYXkKICAgICAgICBjb25zdCBjbGVhblJvdXRlID0gaHJlZi5zcGxpdCgnPycpWzBdLnNwbGl0KCcjJylbMF07CiAgICAgICAgaWYgKGNsZWFuUm91dGUgJiYgY2xlYW5Sb3V0ZS5sZW5ndGggPCA1MCkgewogICAgICAgICAgZGV0ZWN0ZWRSb3V0ZXMuYWRkKGNsZWFuUm91dGUpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CgogICAgLy8gTWV0aG9kIDM6IExvb2sgZm9yIE5hdkxpbmsvTGluayBjb21wb25lbnRzIChSZWFjdCBSb3V0ZXIpCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbY2xhc3MqPSJuYXYiXSwgW2NsYXNzKj0ibWVudSJdLCBuYXYnKS5mb3JFYWNoKG5hdiA9PiB7CiAgICAgIG5hdi5xdWVyeVNlbGVjdG9yQWxsKCdhJykuZm9yRWFjaChlbCA9PiB7CiAgICAgICAgY29uc3QgaHJlZiA9IGVsLmdldEF0dHJpYnV0ZSgnaHJlZicpOwogICAgICAgIGlmIChocmVmICYmIGhyZWYuc3RhcnRzV2l0aCgnLycpKSB7CiAgICAgICAgICBjb25zdCBjbGVhblJvdXRlID0gaHJlZi5zcGxpdCgnPycpWzBdLnNwbGl0KCcjJylbMF07CiAgICAgICAgICBpZiAoY2xlYW5Sb3V0ZSAmJiBjbGVhblJvdXRlLmxlbmd0aCA8IDUwKSB7CiAgICAgICAgICAgIGRldGVjdGVkUm91dGVzLmFkZChjbGVhblJvdXRlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgfQoKICAvLyBNb25pdG9yIGZvciByb3V0ZSBjaGFuZ2VzCiAgZnVuY3Rpb24gc2V0dXBSb3V0ZU1vbml0b3JpbmcoKSB7CiAgICAvLyBUcmFjayBjdXJyZW50IGxvY2F0aW9uCiAgICBjb25zdCB1cGRhdGVDdXJyZW50Um91dGUgPSAoKSA9PiB7CiAgICAgIGNvbnN0IG5ld1JvdXRlID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lIHx8ICcvJzsKICAgICAgaWYgKG5ld1JvdXRlICE9PSBjdXJyZW50Um91dGUpIHsKICAgICAgICBjdXJyZW50Um91dGUgPSBuZXdSb3V0ZTsKICAgICAgICBkZXRlY3RlZFJvdXRlcy5hZGQoY3VycmVudFJvdXRlKTsKICAgICAgICBzZW5kVG9QYXJlbnQoJ3JvdXRlLWNoYW5nZWQnLCB7IGN1cnJlbnRSb3V0ZSwgcm91dGVzOiBBcnJheS5mcm9tKGRldGVjdGVkUm91dGVzKS5zb3J0KCkgfSk7CiAgICAgIH0KICAgIH07CgogICAgLy8gTGlzdGVuIGZvciBwb3BzdGF0ZSAoYmFjay9mb3J3YXJkKQogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3BvcHN0YXRlJywgdXBkYXRlQ3VycmVudFJvdXRlKTsKCiAgICAvLyBJbnRlcmNlcHQgcHVzaFN0YXRlIGFuZCByZXBsYWNlU3RhdGUKICAgIGNvbnN0IG9yaWdpbmFsUHVzaFN0YXRlID0gaGlzdG9yeS5wdXNoU3RhdGU7CiAgICBjb25zdCBvcmlnaW5hbFJlcGxhY2VTdGF0ZSA9IGhpc3RvcnkucmVwbGFjZVN0YXRlOwoKICAgIGhpc3RvcnkucHVzaFN0YXRlID0gZnVuY3Rpb24oKSB7CiAgICAgIG9yaWdpbmFsUHVzaFN0YXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIHNldFRpbWVvdXQodXBkYXRlQ3VycmVudFJvdXRlLCAwKTsKICAgIH07CgogICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUgPSBmdW5jdGlvbigpIHsKICAgICAgb3JpZ2luYWxSZXBsYWNlU3RhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgc2V0VGltZW91dCh1cGRhdGVDdXJyZW50Um91dGUsIDApOwogICAgfTsKCiAgICAvLyBMaXN0ZW4gZm9yIGhhc2hjaGFuZ2UgKGhhc2ggcm91dGluZykKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdoYXNoY2hhbmdlJywgKCkgPT4gewogICAgICBjb25zdCBoYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2g7CiAgICAgIGlmIChoYXNoICYmIGhhc2guc3RhcnRzV2l0aCgnIy8nKSkgewogICAgICAgIGN1cnJlbnRSb3V0ZSA9IGhhc2guc2xpY2UoMSk7IC8vIFJlbW92ZSAjCiAgICAgICAgZGV0ZWN0ZWRSb3V0ZXMuYWRkKGN1cnJlbnRSb3V0ZSk7CiAgICAgICAgc2VuZFRvUGFyZW50KCdyb3V0ZS1jaGFuZ2VkJywgeyBjdXJyZW50Um91dGUsIHJvdXRlczogQXJyYXkuZnJvbShkZXRlY3RlZFJvdXRlcykuc29ydCgpIH0pOwogICAgICB9CiAgICB9KTsKICB9CgogIC8vIExpc3RlbiBmb3IgbmF2aWdhdGlvbiBjb21tYW5kcyBmcm9tIHBhcmVudAogIGZ1bmN0aW9uIHNldHVwQ29tbWFuZExpc3RlbmVyKCkgewogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCAoZXZlbnQpID0+IHsKICAgICAgY29uc3QgZGF0YSA9IGV2ZW50LmRhdGE7CiAgICAgIGlmICghZGF0YSB8fCBkYXRhLnNvdXJjZSAhPT0gJ3ZpYmUtcm91dGUtY29tbWFuZCcpIHJldHVybjsKCiAgICAgIHN3aXRjaCAoZGF0YS5hY3Rpb24pIHsKICAgICAgICBjYXNlICduYXZpZ2F0ZSc6CiAgICAgICAgICBpZiAoZGF0YS5wYXRoKSB7CiAgICAgICAgICAgIC8vIFRyeSBSZWFjdCBSb3V0ZXIgbmF2aWdhdGlvbiBmaXJzdAogICAgICAgICAgICBpZiAod2luZG93Ll9fdmliZU5hdmlnYXRlKSB7CiAgICAgICAgICAgICAgd2luZG93Ll9fdmliZU5hdmlnYXRlKGRhdGEucGF0aCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gRmFsbGJhY2sgdG8gaGlzdG9yeSBBUEkKICAgICAgICAgICAgICBoaXN0b3J5LnB1c2hTdGF0ZSh7fSwgJycsIGRhdGEucGF0aCk7CiAgICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IFBvcFN0YXRlRXZlbnQoJ3BvcHN0YXRlJykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN1cnJlbnRSb3V0ZSA9IGRhdGEucGF0aDsKICAgICAgICAgICAgc2VuZFRvUGFyZW50KCdyb3V0ZS1jaGFuZ2VkJywgeyBjdXJyZW50Um91dGUsIHJvdXRlczogQXJyYXkuZnJvbShkZXRlY3RlZFJvdXRlcykuc29ydCgpIH0pOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ2RldGVjdCc6CiAgICAgICAgICBkZXRlY3RSZWFjdFJvdXRlclJvdXRlcygpOwogICAgICAgICAgcmVwb3J0U3RhdGUoKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdnZXQtc3RhdGUnOgogICAgICAgICAgcmVwb3J0U3RhdGUoKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9KTsKICB9CgogIC8vIEV4cG9zZSBuYXZpZ2F0aW9uIGhlbHBlciBmb3IgUmVhY3QgUm91dGVyIGludGVncmF0aW9uCiAgd2luZG93Ll9fdmliZVNldE5hdmlnYXRlID0gZnVuY3Rpb24obmF2aWdhdGVGbikgewogICAgd2luZG93Ll9fdmliZU5hdmlnYXRlID0gbmF2aWdhdGVGbjsKICB9OwoKICAvLyBJbml0aWFsaXplCiAgZnVuY3Rpb24gaW5pdCgpIHsKICAgIHNldHVwUm91dGVNb25pdG9yaW5nKCk7CiAgICBzZXR1cENvbW1hbmRMaXN0ZW5lcigpOwoKICAgIC8vIEluaXRpYWwgZGV0ZWN0aW9uIGFmdGVyIERPTSBpcyByZWFkeQogICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdsb2FkaW5nJykgewogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4gewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgZGV0ZWN0UmVhY3RSb3V0ZXJSb3V0ZXMoKTsKICAgICAgICAgIHJlcG9ydFN0YXRlKCk7CiAgICAgICAgfSwgNTAwKTsgLy8gV2FpdCBmb3IgUmVhY3QgdG8gcmVuZGVyCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgZGV0ZWN0UmVhY3RSb3V0ZXJSb3V0ZXMoKTsKICAgICAgICByZXBvcnRTdGF0ZSgpOwogICAgICB9LCA1MDApOwogICAgfQoKICAgIC8vIFJlLWRldGVjdCBwZXJpb2RpY2FsbHkgZm9yIFNQQXMgdGhhdCBsb2FkIHJvdXRlcyBkeW5hbWljYWxseQogICAgbGV0IGRldGVjdENvdW50ID0gMDsKICAgIGNvbnN0IGRldGVjdEludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgICBkZXRlY3RSZWFjdFJvdXRlclJvdXRlcygpOwogICAgICBkZXRlY3RDb3VudCsrOwogICAgICAvLyBTdG9wIGFmdGVyIDEwIGRldGVjdGlvbnMgKDUgc2Vjb25kcykKICAgICAgaWYgKGRldGVjdENvdW50ID49IDEwKSB7CiAgICAgICAgY2xlYXJJbnRlcnZhbChkZXRlY3RJbnRlcnZhbCk7CiAgICAgIH0KICAgIH0sIDUwMCk7CgogICAgLy8gQWxzbyBkZXRlY3Qgb24gYW55IGNsaWNrIChtaWdodCByZXZlYWwgbmV3IHJvdXRlcykKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICBzZXRUaW1lb3V0KGRldGVjdFJlYWN0Um91dGVyUm91dGVzLCAxMDApOwogICAgfSwgeyBwYXNzaXZlOiB0cnVlIH0pOwoKICB9CgogIGluaXQoKTsKfSkoKTsK")));(0,eval)(_)}catch(e){}})();</script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>